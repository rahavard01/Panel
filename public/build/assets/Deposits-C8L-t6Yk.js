import{_ as re,u as de,f as ue,r as f,j as b,i as ce,w as U,k as pe,g as ve,c,a as t,l as fe,n as S,d as y,F as be,s as ge,x as N,t as o,m as q,y as me,b as $,q as D,v as ye,T as we,e as C,o as r}from"./app-CII0XI0-.js";const ke={class:"billing-root",dir:"ltr"},xe={class:"segmented",dir:"rtl",style:{"margin-bottom":"10px"}},he={class:"table-shell"},_e={class:"table-scroll table-scroll-rtl"},Pe={class:"table table-bordered mt-4 text-center billing-table"},Se={class:"billing-thead"},Ce={class:"th-sort-inner"},Le={key:0},Re={key:1},ze=["onClick"],je={class:"text-nowrap"},Ne={key:0,class:"code-badge"},De={class:"text-nowrap"},Te={class:"code-badge"},Ae={class:"text-nowrap"},Ue={class:"pagination-wrapper",style:{display:"flex","flex-direction":"column","align-items":"center","justify-content":"center",gap:"6px","margin-top":"28px","font-size":"12px",color:"#d0d0d0"}},$e={style:{display:"flex","align-items":"center",gap:"10px"}},Be=["disabled","aria-disabled"],Ee=["disabled","aria-disabled"],Me={style:{opacity:".7"}},Fe=["disabled","aria-disabled"],Ie=["disabled","aria-disabled"],Oe={class:"modal-outer"},Ve={class:"final-result1"},Ye={class:"edit-form"},qe={class:"edit-row"},Ge={class:"edit-input"},He={class:"value-field"},We={class:"value-chip name"},Je={class:"edit-row"},Ke={class:"edit-input"},Qe={class:"value-field"},Xe={class:"value-chip amount"},Ze={class:"edit-row"},et={class:"edit-input"},tt={class:"value-field"},st={class:"value-chip method"},at={class:"edit-row"},lt={class:"edit-input"},nt={key:1,class:"muted"},ot={class:"edit-row"},it={class:"edit-input"},rt={class:"edit-row actions-row"},dt={class:"edit-input"},ut=["disabled"],ct=["disabled"],pt={key:0,class:"creating-overlay","aria-live":"polite"},vt={class:"back-button",style:{"text-align":"center","margin-top":"12px"}},ft={__name:"Deposits",setup(bt){const{poll60:G}=de(),{success:B,error:p}=ue(),w=f("pending"),T=f(!1),x=f([]),E=b(()=>[...x.value].sort((s,e)=>F(s)-F(e))),H=b(()=>[...E.value].reverse()),M=b(()=>h.value?E.value:H.value),l=ce({pageSize:20,currentPage:1}),L=b(()=>M.value.length),R=b(()=>Math.max(1,Math.ceil(L.value/l.pageSize)));U(()=>l.pageSize,()=>{l.currentPage=1}),U([()=>x.value.length,()=>l.pageSize],()=>{const s=R.value;l.currentPage>s&&(l.currentPage=s)});const W=b(()=>{const s=(l.currentPage-1)*l.pageSize,e=s+l.pageSize;return M.value.slice(s,e)});b(()=>{const s=(l.currentPage-1)*l.pageSize;return Math.max(0,L.value-s)});const d=b(()=>l.currentPage===1),u=b(()=>l.currentPage>=R.value);function J(){d.value||(l.currentPage=1)}function K(){d.value||l.currentPage--}function Q(){u.value||l.currentPage++}function X(){u.value||(l.currentPage=R.value)}const h=f(!1);function Z(){h.value=!h.value,l.currentPage=1}function F(s){const e=s?.created_at??s?.id??0;if(typeof e=="string"){const a=Date.parse(e);if(!Number.isNaN(a))return a;const n=Number(e);return Number.isFinite(n)?n:0}return Number(e)||0}const A=f(!1),v=f(!1),i=f({}),z=f("");f(0);function ee(){try{document.body.style.overflow="hidden"}catch{}}function I(){try{document.body.style.overflow="",document.body.classList?.remove?.("lock-scroll")}catch{}}pe(()=>I());function O(s){return s==null?"—":(Number(s)||0).toLocaleString("fa-IR")}function te(s){if(!s)return"—";try{return new Date(s).toLocaleString("fa-IR")}catch{return"—"}}function V(s){const e=String(s||"").toLowerCase();return e==="card"?"کارت به کارت":e==="gateway"?"درگاه":e==="manual"?"پنل ادمین":s||"—"}function se(s){const e=String(s||"").toLowerCase();return e==="submitted"||e==="pending"?"در انتظار":e==="verified"||e==="approved"?"تأیید شده":e==="rejected"||e==="failed"?"رد شده":e==="uploaded"||e==="failed"?"ارسال ناموفق":s||"—"}function ae(s){const e=String(s||"").toLowerCase();return{chip:!0,"chip--success":e==="verified"||e==="approved","chip--pending":e==="submitted"||e==="pending","chip--failed":e==="rejected"||e==="failed","chip--failed1":e==="uploaded"||e==="failed"}}async function g({silent:s=!1,keepPage:e=!0}={}){s||(T.value=!0);try{const{data:a}=await C.get("/admin/wallet/receipts",{params:{status:w.value}});x.value=Array.isArray(a?.data)?a.data:Array.isArray(a)?a:[]}catch{p("خطا در دریافت لیست واریزی‌ها",{mode:"global"}),x.value=[]}finally{s||(T.value=!1)}}function j(s){w.value!==s&&(w.value=s,l.currentPage=1,g())}async function le(s){ee(),v.value=!1,z.value="",i.value=null;try{const{data:e}=await C.get(`/admin/wallet/receipts/${s}`);i.value=e?.data||e||{},A.value=!0}catch{p("دریافت جزئیات واریزی ناموفق بود"),m()}}function m(s=!1){v.value&&!s||(A.value=!1,I())}async function ne(){if(!i.value?.id)return;const s=i.value.id,e=Number(i.value?.amount||0);if(await Y(s)){v.value=!0;try{await C.post(`/admin/wallet/receipts/${s}/verify`,{amount:e}),B("واریزی با موفقیت تایید شد"),m(!0),await g({silent:!0,keepPage:!0})}catch(a){const n=a?.response?.status,k=a?.response?.data?.code;n===409||k==="ALREADY_PROCESSED"?(p("این واریزی قبلاً رسیدگی شده است"),m(!0),await g({silent:!0,keepPage:!0})):p("تایید واریزی ناموفق بود")}finally{v.value=!1}}}async function oe(){if(!i.value?.id)return;const s=i.value.id;if(!await Y(s))return;const e=z.value||null;v.value=!0;try{await C.post(`/admin/wallet/receipts/${s}/reject`,{reason:e}),B("واریزی با موفقیت رد شد"),m(!0),await g({silent:!0,keepPage:!0})}catch(a){const n=a?.response?.status,k=a?.response?.data?.code;n===409||k==="ALREADY_PROCESSED"?(p("این واریزی قبلاً رسیدگی شده است"),m(!0),await g({silent:!0,keepPage:!0})):p("رد واریزی ناموفق بود")}finally{v.value=!1}}ve(()=>g({keepPage:!0}));async function Y(s){try{const e=await C.get(`/admin/wallet/receipts/${s}`),a=e?.data?.data??e?.data??{},n=String(a.status??"").toLowerCase();return new Set(["pending","uploaded","submitted"]).has(n)?!0:(p("این واریزی قبلاً رسیدگی شده است"),m(!0),await g({silent:!0,keepPage:!0}),!1)}catch{return!0}}function ie(s){const e=window.open("about:blank","_blank");if(!e){p("مرورگر باز شدن پنجره را مسدود کرد. اجازهٔ پاپ‌آپ را فعال کنید.");return}try{e.opener=null}catch{}try{e.document.write('<!doctype html><title>... در حال بارگذاری </title><div style="font-family:sans-serif;padding:16px;color:#444">... در حال بارگذاری </div>')}catch{}C.get(`/admin/wallet/receipts/${s}/file`,{responseType:"blob"}).then(a=>{const n=(a?.headers?.["content-type"]||"application/octet-stream").toLowerCase(),k=new Blob([a.data],{type:n}),_=URL.createObjectURL(k);try{if(n.startsWith("image/")){e.document.body.innerHTML="";const P=e.document.createElement("img");P.style.cssText="max-width:100%;height:auto;display:block;margin:0 auto;",P.onload=()=>{try{URL.revokeObjectURL(_)}catch{}},P.onerror=()=>{},P.src=_,e.document.body.appendChild(P)}else e.location.href=_,setTimeout(()=>{try{URL.revokeObjectURL(_)}catch{}},12e4)}catch{try{e.location.href=_}catch{}setTimeout(()=>{try{URL.revokeObjectURL(_)}catch{}},12e4)}}).catch(a=>{try{e.close()}catch{}p("نمایش فایل رسید ناموفق بود"),console.error("openReceiptInline error",a?.response?.status,a)})}return U(G,()=>g({silent:!0,keepPage:!0})),(s,e)=>(r(),c("div",ke,[e[34]||(e[34]=t("h3",{class:"topup-title"},"مدیریت واریزی‌ها",-1)),t("div",xe,[t("button",{type:"button",class:S(["seg-btn",{active:w.value==="all"}]),onClick:e[0]||(e[0]=a=>j("all"))},"همه",2),t("button",{type:"button",class:S(["seg-btn",{active:w.value==="verified"}]),onClick:e[1]||(e[1]=a=>j("verified"))},"تأیید شده",2),t("button",{type:"button",class:S(["seg-btn",{active:w.value==="rejected"}]),onClick:e[2]||(e[2]=a=>j("rejected"))},"رد شده",2),t("button",{type:"button",class:S(["seg-btn",{active:w.value==="pending"}]),onClick:e[3]||(e[3]=a=>j("pending"))},"در انتظار",2)]),t("div",he,[t("div",_e,[t("table",Pe,[t("thead",Se,[t("tr",null,[e[9]||(e[9]=t("th",null,"عملیات",-1)),e[10]||(e[10]=t("th",null,"تاریخ",-1)),e[11]||(e[11]=t("th",null,"وضعیت",-1)),e[12]||(e[12]=t("th",null,"مبلغ",-1)),e[13]||(e[13]=t("th",null,"شیوه پرداخت",-1)),e[14]||(e[14]=t("th",null,"کد پنل",-1)),e[15]||(e[15]=t("th",null,"نام کاربر",-1)),t("th",{onClick:Z,class:"th-sortable"},[t("span",Ce,[e[8]||(e[8]=t("span",null,"ردیف",-1)),t("span",{class:S(["caret",{up:h.value,down:!h.value}]),"aria-hidden":"true"},null,2)])])])]),t("tbody",null,[T.value?(r(),c("tr",Le,e[16]||(e[16]=[t("td",{colspan:"8",class:"table-info-row"},[y("... در حال بارگذاری "),t("i",{class:"fas fa-spinner fa-spin"})],-1)]))):!x.value||x.value.length===0?(r(),c("tr",Re,e[17]||(e[17]=[t("td",{colspan:"8",class:"table-info-row"},[y("موردی یافت نشد "),t("i",{class:"fas fa-exclamation-triangle",style:{"margin-left":"8px"}})],-1)]))):(r(!0),c(be,{key:2},ge(W.value,(a,n)=>(r(),c("tr",{key:a.id},[t("td",null,[t("button",{type:"button",class:"view-btn",onClick:k=>le(a.id)},"بررسی",8,ze)]),t("td",null,o(te(a.created_at)),1),t("td",null,[t("span",{class:S(ae(a.status))},o(se(a.status)),3)]),t("td",null,o(O(a.amount)),1),t("td",je,[t("div",null,o(V(a.method)),1),a.ref?(r(),c("small",Ne,o(a.ref),1)):$("",!0)]),t("td",De,[t("span",Te,o(a.user_code||"-"),1)]),t("td",Ae,o(a.user_name||"-"),1),t("td",null,o(h.value?(l.currentPage-1)*l.pageSize+n+1:L.value-((l.currentPage-1)*l.pageSize+n)),1)]))),128))])])])]),t("div",Ue,[t("div",$e,[t("button",{onClick:J,disabled:d.value,"aria-disabled":d.value,style:N({background:"#2a2a2a",color:"#fff",border:"1px solid #444",borderRadius:"8px",padding:"4px 10px",cursor:d.value?"not-allowed":"pointer",opacity:d.value?.4:.95})},"⏮︎",12,Be),t("button",{onClick:K,disabled:d.value,"aria-disabled":d.value,style:N({background:"#2a2a2a",color:"#fff",border:"1px solid #444",borderRadius:"8px",padding:"4px 10px",cursor:d.value?"not-allowed":"pointer",opacity:d.value?.4:.95})},e[18]||(e[18]=[t("span",{class:"pagination-icon"},"◀",-1)]),12,Ee),t("span",null,[y(" صفحه "+o(l.currentPage)+" از "+o(R.value)+" ",1),t("span",Me,"( کل واریزی‌ها : "+o(L.value)+" )",1)]),t("button",{onClick:Q,disabled:u.value,"aria-disabled":u.value,style:N({background:"#2a2a2a",color:"#fff",border:"1px solid #444",borderRadius:"8px",padding:"4px 10px",cursor:u.value?"not-allowed":"pointer",opacity:u.value?.4:.95})},e[19]||(e[19]=[t("span",{class:"pagination-icon"},"▶",-1)]),12,Fe),t("button",{onClick:X,disabled:u.value,"aria-disabled":u.value,style:N({background:"#2a2a2a",color:"#fff",border:"1px solid #444",borderRadius:"8px",padding:"4px 10px",cursor:u.value?"not-allowed":"pointer",opacity:u.value?.4:.95})},"⏭︎",12,Ie)]),t("div",null,[e[21]||(e[21]=y(" نمایش ",-1)),q(t("select",{"onUpdate:modelValue":e[4]||(e[4]=a=>l.pageSize=a),style:{background:"#2a2a2a",color:"#fff",border:"1px solid #444","border-radius":"6px",padding:"4px 8px",margin:"0 6px"}},e[20]||(e[20]=[t("option",{value:20},"20",-1),t("option",{value:50},"50",-1),t("option",{value:100},"100",-1),t("option",{value:500},"500",-1)]),512),[[me,l.pageSize,void 0,{number:!0}]]),e[22]||(e[22]=y(" ردیف در هر صفحه ",-1))])]),(r(),fe(we,{to:"body"},[A.value?(r(),c("div",{key:0,class:"modal-backdrop",onClick:D(m,["self"])},[t("div",Oe,[t("div",{class:"create-modal",onClick:e[7]||(e[7]=D(()=>{},["stop"]))},[e[33]||(e[33]=t("div",{style:{display:"flex","align-items":"center","justify-content":"center","margin-bottom":"18px","font-size":"18px",color:"#fff","text-shadow":"0 0 15px rgba(255,153,0,1)"}},[t("div",{style:{"font-weight":"700"}},"بررسی واریزی")],-1)),t("div",Ve,[t("div",Ye,[t("div",qe,[e[24]||(e[24]=t("label",{class:"edit-label"},"نام کاربر",-1)),t("div",Ge,[t("div",He,[t("span",We,[e[23]||(e[23]=t("i",{class:"fas fa-user-tie"},null,-1)),y(" "+o(i.value.user_name||"-"),1)])])])]),t("div",Je,[e[26]||(e[26]=t("label",{class:"edit-label"},"مبلغ واریزی",-1)),t("div",Ke,[t("div",Qe,[t("span",Xe,[e[25]||(e[25]=t("i",{class:"fas fa-coins"},null,-1)),y(" "+o(O(i.value.amount)),1)])])])]),t("div",Ze,[e[28]||(e[28]=t("label",{class:"edit-label"},"شیوه پرداخت",-1)),t("div",et,[t("div",tt,[t("span",st,[e[27]||(e[27]=t("i",{class:"fas fa-bookmark"},null,-1)),y(" "+o(V(i.value.method)),1)])])])]),t("div",at,[e[29]||(e[29]=t("label",{class:"edit-label"},"رسید پرداخت",-1)),t("div",lt,[i.value?.id?(r(),c("button",{key:0,type:"button",class:"link",onClick:e[5]||(e[5]=D(a=>ie(i.value.id),["stop"]))}," مشاهده رسید ")):(r(),c("span",nt,"—"))])]),t("div",ot,[e[30]||(e[30]=t("label",{class:"edit-label"},"یادداشت",-1)),t("div",it,[q(t("input",{"onUpdate:modelValue":e[6]||(e[6]=a=>z.value=a),type:"text",class:"note-input",placeholder:"دلیل رد (اختیاری)"},null,512),[[ye,z.value]])])])]),t("div",rt,[e[31]||(e[31]=t("label",{class:"edit-label"},null,-1)),t("div",dt,[t("button",{class:"btn btn-danger btn-ghost",disabled:v.value,onClick:oe},"رد",8,ut),t("button",{class:"btn-create-user1",disabled:v.value,onClick:ne},"تأیید",8,ct)])])]),v.value?(r(),c("div",pt,e[32]||(e[32]=[t("div",{class:"creating-box"},[t("span",null,"... در حال ثبت"),t("i",{class:"fas fa-spinner fa-spin"})],-1)]))):$("",!0),t("div",vt,[t("a",{href:"#",onClick:D(m,["prevent"])},"بازگشت")])])])])):$("",!0)]))]))}},mt=re(ft,[["__scopeId","data-v-b439d46c"]]);export{mt as default};
