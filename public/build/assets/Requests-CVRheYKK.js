import{_ as xe,e as ke,u as we,r as n,g as Pe,i as y,w as Y,f as Ne,j as ze,c as u,a as t,k as Se,n as U,b as v,F as Ce,s as he,x as A,t as i,l as g,y as Ie,q as Z,p as G,v as w,A as ee,T as Re,d as j,o as r}from"./app-B_MvGmoT.js";const Le={class:"billing-root",dir:"ltr"},Ve={class:"segmented",style:{"margin-bottom":"10px"}},De={class:"table-shell"},Ue={class:"table-scroll table-scroll-rtl"},je={class:"table table-bordered mt-4 text-center billing-table"},Be={class:"billing-thead"},Fe={class:"th-sort-inner"},Me={key:0},Te={key:1},$e=["onClick"],Ae={class:"text-nowrap"},qe={class:"code-badge",style:{"margin-top":"2px"}},Ee={class:"text-nowrap"},Ge={class:"code-badge"},Oe={class:"pagination-wrapper",style:{display:"flex","flex-direction":"column","align-items":"center","justify-content":"center",gap:"6px","margin-top":"28px","font-size":"12px",color:"#d0d0d0"}},He={style:{display:"flex","align-items":"center",gap:"10px"}},Je=["disabled","aria-disabled"],Ke=["disabled","aria-disabled"],Qe={style:{opacity:".7"}},We=["disabled","aria-disabled"],Xe=["disabled","aria-disabled"],Ye={class:"modal-outer"},Ze={class:"final-result1"},et={class:"edit-form"},tt={class:"edit-row"},lt={class:"edit-input"},at={class:"value-field"},st={class:"value-chip email ltr",style:{"vertical-align":"middle",width:"100%"}},it={class:"edit-row"},nt={class:"edit-input"},ot={class:"value-field"},rt={class:"value-chip code"},ut={class:"value-chip name"},dt={class:"edit-row"},pt={class:"edit-row"},ct={style:{display:"flex",gap:"20px",width:"100%"}},vt={style:{display:"flex","align-items":"center",gap:"6px","font-size":"12px","white-space":"nowrap"}},gt={style:{display:"flex","align-items":"center",gap:"6px","font-size":"12px"}},ft={key:0,class:"edit-row edit-row--note"},mt={class:"edit-input",style:{opacity:".9"}},bt={key:0,class:"note-bubble"},_t={key:1,class:"note-bubble"},yt={key:1,class:"edit-row"},xt={class:"grid-prices"},kt={class:"price-field",style:{"grid-column":"1 / -1"}},wt={class:"price-field"},Pt={class:"price-field"},Nt={class:"price-field"},zt={class:"price-field"},St={class:"price-field",style:{"grid-column":"1 / -1"}},Ct={class:"edit-row actions-row"},ht={class:"edit-input"},It=["disabled"],Rt=["disabled"],Lt={key:0,class:"creating-overlay","aria-live":"polite"},Vt={class:"back-button",style:{"text-align":"center","margin-top":"12px"}},Dt={__name:"Requests",setup(Ut){const{success:O,error:b}=ke(),{poll60:te}=we(),x=n("pending"),q=n(!1),P=n([]),s=Pe({pageSize:20,currentPage:1,total:0,lastPage:1}),H=y(()=>Number(s.total||0)),B=y(()=>Math.max(1,Number(s.lastPage||s.last_page||1))),d=y(()=>Number(s.currentPage)<=1),p=y(()=>Number(s.currentPage)>=B.value);Y(()=>s.pageSize,()=>{s.currentPage=1,c()});const N=n(!1);function le(){N.value=!N.value,s.currentPage=1,c()}const J=y(()=>{const a=e=>{if(e==null)return 0;const l=Number(e);if(Number.isFinite(l))return l;const _=Date.parse(e);return Number.isFinite(_)?_:0};return[...P.value].sort((e,l)=>{const _=a(e.created_at)||Number(e.id)||0,$=a(l.created_at)||Number(l.id)||0;return _-$})}),ae=y(()=>[...J.value].reverse()),se=y(()=>N.value?J.value:ae.value);async function c({silent:a=!1}={}){a||(q.value=!0);try{const{data:e}=await j.get("/admin/referrals",{params:{status:x.value??"",page:s.currentPage,per_page:s.pageSize}});if(e?.ok){P.value=Array.isArray(e.items)?e.items:[];const l=e.pagination||{},_=l.total??0,$=l.lastPage??l.last_page??1,_e=l.currentPage??l.page??s.currentPage,ye=l.pageSize??l.per_page??s.pageSize;Object.assign(s,{total:Number(_)||0,lastPage:Number($)||1,currentPage:Number(_e)||1,pageSize:Number(ye)||20});const X=Math.max(1,Number(s.lastPage||1));s.currentPage>X&&(s.currentPage=X),s.currentPage<1&&(s.currentPage=1)}else b(e?.message||"دریافت لیست با خطا مواجه شد",{mode:"global"})}catch{b("ارتباط با سرور برقرار نشد",{mode:"global"})}finally{a||(q.value=!1)}}function F(a){x.value!==a&&(x.value=a,s.currentPage=1,c())}function M(a){const e=B.value,l=Number(a||1);l>=1&&l<=e&&(s.currentPage=l,c())}function ie(){d.value||M(1)}function ne(){d.value||M(Number(s.currentPage)-1)}function oe(){p.value||M(Number(s.currentPage)+1)}function re(){p.value||M(B.value)}function ue(a){return N.value?(s.currentPage-1)*s.pageSize+a+1:H.value-((s.currentPage-1)*s.pageSize+a)}function de(a){const e=(a||"").toString().toLowerCase();return e==="success"||e==="approved"?"تأیید شده":e==="pending"?"در انتظار":e==="failed"||e==="rejected"?"رد شده":a||"-"}function pe(a){const e=(a||"").toString().toLowerCase();return{chip:!0,"chip--success":e==="success"||e==="approved","chip--pending":e==="pending","chip--failed":e==="failed"||e==="rejected"}}function ce(a){if(!a)return"-";const e=new Date(a);return isNaN(e)?String(a):new Intl.DateTimeFormat("fa-IR",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}).format(e)}const E=n(!1),f=n(!1),z=n(null),o=n(null),k=n(10),m=n("like_referrer"),S=n(""),C=n(""),h=n(""),I=n(""),R=n(""),L=n("");function ve(a){be(),z.value=a,ge(a)}function T(){W(),E.value=!1,z.value=null,o.value=null,k.value=10,m.value="like_referrer",S.value="",C.value="",h.value="",I.value="",R.value="",L.value=""}async function ge(a){f.value=!0;try{const{data:e}=await j.get(`/admin/referrals/${a}`);if(!e?.ok||!e?.item){b("یافتن جزئیات درخواست ناموفق بود",{mode:"global"});return}if(o.value=e.item,o.value.pricing_like_referrer=e.pricing_like_referrer||null,k.value=Number(e.defaults?.commission_percent??10)||10,o.value.pricing_strategy==="custom"){m.value="custom";const l=o.value.pricing_payload||{};S.value=l.personalized_price_test??"",C.value=l.personalized_price_1??"",h.value=l.personalized_price_3??"",I.value=l.personalized_price_6??"",R.value=l.personalized_price_12??"",L.value=l.traffic_price??""}else m.value="like_referrer";E.value=!0}catch{b("ارتباط با سرور برقرار نشد",{mode:"global"})}finally{f.value=!1}}const K=y(()=>m.value==="custom");async function fe(){if(!z.value)return;const a={pricing_strategy:m.value};k.value!==null&&k.value!==void 0&&(a.commission_percent=Number(k.value)),K.value&&(a.pricing_payload={personalized_price_test:Number(S.value||0),personalized_price_1:Number(C.value||0),personalized_price_3:Number(h.value||0),personalized_price_6:Number(I.value||0),personalized_price_12:Number(R.value||0),traffic_price:Number(L.value||0)}),f.value=!0;try{const{data:e}=await j.post(`/admin/referrals/${z.value}/approve`,a);if(!e?.ok){b(e?.message||"تأیید درخواست ناموفق بود",{mode:"global"});return}O("درخواست با موفقیت تأیید شد",{mode:"global"}),await c({silent:!0}),!P.value.length&&s.currentPage>1&&(s.currentPage-=1,await c({silent:!0})),Q(),T()}catch(e){const l=e?.response?.data?.message||"خطا در تأیید درخواست";b(l,{mode:"global"})}finally{f.value=!1}}async function me(){if(!z.value)return;const a=window.prompt("دلیل رد (اختیاری):","")||null;f.value=!0;try{const{data:e}=await j.post(`/admin/referrals/${z.value}/reject`,{reason:a});if(!e?.ok){b(e?.message||"رد کردن درخواست ناموفق بود",{mode:"global"});return}O("درخواست رد شد",{mode:"global"}),await c({silent:!0}),!P.value.length&&s.currentPage>1&&(s.currentPage-=1,await c({silent:!0})),Q(),T()}catch(e){const l=e?.response?.data?.message||"خطا در رد کردن درخواست";b(l,{mode:"global"})}finally{f.value=!1}}async function Q(){try{const{data:a}=await j.get("/admin/referrals/count"),e=Number(a?.count||0);window.dispatchEvent(new CustomEvent("admin:badge:update",{detail:{referrals:e}}))}catch{}}Ne(()=>c()),Y(te,()=>c({silent:!0})),n(0);function be(){try{document.body.style.overflow="hidden"}catch{}}function W(){try{document.body.style.overflow="",document.body.classList.remove("lock-scroll")}catch{}}ze(()=>W());function V(a){return a==null||a===""?"":String(Math.trunc(Number(a))).replace(/\D/g,"").replace(/\B(?=(\d{3})+(?!\d))/g,",")}function D(a){return String(a??"").replace(/\D/g,"")}return(a,e)=>(r(),u("div",Le,[e[48]||(e[48]=t("h3",{class:"topup-title"},"مدیریت درخواست‌ها",-1)),t("div",Ve,[t("button",{type:"button",class:U(["seg-btn",{active:x.value==="pending"}]),onClick:e[0]||(e[0]=l=>F("pending"))},"در انتظار",2),t("button",{type:"button",class:U(["seg-btn",{active:x.value==="rejected"}]),onClick:e[1]||(e[1]=l=>F("rejected"))},"رد شده",2),t("button",{type:"button",class:U(["seg-btn",{active:x.value==="approved"}]),onClick:e[2]||(e[2]=l=>F("approved"))},"تأیید شده",2),t("button",{type:"button",class:U(["seg-btn",{active:x.value==="all"}]),onClick:e[3]||(e[3]=l=>F("all"))},"همه",2)]),t("div",De,[t("div",Ue,[t("table",je,[t("thead",Be,[t("tr",null,[e[22]||(e[22]=t("th",null,"عملیات",-1)),e[23]||(e[23]=t("th",null,"تاریخ درخواست",-1)),e[24]||(e[24]=t("th",null,"وضعیت",-1)),e[25]||(e[25]=t("th",null,"( کد/ایمیل/نام ) نماینده جدید",-1)),e[26]||(e[26]=t("th",null,"( کد/نام ) معرف ",-1)),t("th",{onClick:le,class:"th-sortable"},[t("span",Fe,[e[21]||(e[21]=t("span",null,"ردیف",-1)),t("span",{class:U(["caret",{up:N.value,down:!N.value}]),"aria-hidden":"true"},null,2)])])])]),t("tbody",null,[q.value?(r(),u("tr",Me,e[27]||(e[27]=[t("td",{colspan:6,class:"table-info-row"},[v("... در حال بارگذاری "),t("i",{class:"fas fa-spinner fa-spin"})],-1)]))):!P.value||P.value.length===0?(r(),u("tr",Te,e[28]||(e[28]=[t("td",{colspan:6,class:"table-info-row"},[v("موردی یافت نشد "),t("i",{class:"fas fa-exclamation-triangle",style:{"margin-left":"8px"}})],-1)]))):(r(!0),u(Ce,{key:2},he(se.value,(l,_)=>(r(),u("tr",{key:l.id},[t("td",null,[t("button",{type:"button",class:"view-btn",onClick:$=>ve(l.id)},"بررسی",8,$e)]),t("td",null,i(ce(l.created_at)),1),t("td",null,[t("span",{class:U(pe(l.status))},i(de(l.status)),3)]),t("td",Ae,[t("div",null,i(l.referee_name||"-"),1),t("small",null," / "+i(l.referee_email)+" / ",1),t("div",qe,i(l.referee_code||"-"),1)]),t("td",Ee,[t("div",null,i(l.referrer_name||"-"),1),t("small",Ge,i(l.referrer_code||"-"),1)]),t("td",null,i(ue(_)),1)]))),128))])])])]),t("div",Oe,[t("div",He,[t("button",{onClick:ie,disabled:d.value,"aria-disabled":d.value,style:A({background:"#2a2a2a",color:"#fff",border:"1px solid #444",borderRadius:"8px",padding:"4px 10px",cursor:d.value?"not-allowed":"pointer",opacity:d.value?.4:.95})},"⏮︎",12,Je),t("button",{onClick:ne,disabled:d.value,"aria-disabled":d.value,style:A({background:"#2a2a2a",color:"#fff",border:"1px solid #444",borderRadius:"8px",padding:"4px 10px",cursor:d.value?"not-allowed":"pointer",opacity:d.value?.4:.95})},e[29]||(e[29]=[t("span",{class:"pagination-icon"},"◀",-1)]),12,Ke),t("span",null,[v(" صفحه "+i(s.currentPage)+" از "+i(B.value)+" ",1),t("span",Qe,"( کل درخواست‌ها : "+i(H.value)+" )",1)]),t("button",{onClick:oe,disabled:p.value,"aria-disabled":p.value,style:A({background:"#2a2a2a",color:"#fff",border:"1px solid #444",borderRadius:"8px",padding:"4px 10px",cursor:p.value?"not-allowed":"pointer",opacity:p.value?.4:.95})},e[30]||(e[30]=[t("span",{class:"pagination-icon"},"▶",-1)]),12,We),t("button",{onClick:re,disabled:p.value,"aria-disabled":p.value,style:A({background:"#2a2a2a",color:"#fff",border:"1px solid #444",borderRadius:"8px",padding:"4px 10px",cursor:p.value?"not-allowed":"pointer",opacity:p.value?.4:.95})},"⏭︎",12,Xe)]),t("div",null,[e[32]||(e[32]=v(" نمایش ",-1)),g(t("select",{"onUpdate:modelValue":e[4]||(e[4]=l=>s.pageSize=l),style:{background:"#2a2a2a",color:"#fff",border:"1px solid #444","border-radius":"6px",padding:"4px 8px",margin:"0 6px"}},e[31]||(e[31]=[t("option",{value:20},"20",-1),t("option",{value:50},"50",-1),t("option",{value:100},"100",-1),t("option",{value:500},"500",-1)]),512),[[Ie,s.pageSize,void 0,{number:!0}]]),e[33]||(e[33]=v(" ردیف در هر صفحه ",-1))])]),(r(),Se(Re,{to:"body"},[E.value?(r(),u("div",{key:0,class:"modal-backdrop",onClick:G(T,["self"])},[t("div",Ye,[t("div",{class:"create-modal",onClick:e[20]||(e[20]=G(()=>{},["stop"]))},[e[47]||(e[47]=t("div",{style:{display:"flex","align-items":"center","justify-content":"center","margin-bottom":"18px","font-size":"18px",color:"#fff","text-shadow":"0 0 15px rgba(255,153,0,1)"}},[t("div",{style:{"font-weight":"700"}},"بررسی درخواست نمایندگی")],-1)),t("div",Ze,[t("div",et,[t("div",tt,[e[35]||(e[35]=t("label",{class:"edit-label"},"نماینده جدید",-1)),t("div",lt,[t("div",at,[t("span",st,[e[34]||(e[34]=t("i",{class:"fas fa-envelope"},null,-1)),v(" "+i(o.value?.candidate?.email||"-"),1)])])])]),t("div",it,[e[38]||(e[38]=t("label",{class:"edit-label"},"معرّف",-1)),t("div",nt,[t("div",ot,[t("span",rt,[v(i(o.value?.referrer?.code||"-")+" ",1),e[36]||(e[36]=t("i",{class:"fas fa-hashtag"},null,-1))]),t("span",ut,[e[37]||(e[37]=t("i",{class:"fas fa-user-tie"},null,-1)),v(" "+i(o.value?.referrer?.name||"-"),1)])])])]),t("div",dt,[e[39]||(e[39]=t("label",{class:"edit-label",for:"comm"},"درصد کمیسیون",-1)),g(t("input",{id:"comm",class:"edit-input",type:"number",min:"0",max:"100",step:"0.5","onUpdate:modelValue":e[5]||(e[5]=l=>k.value=l),autocomplete:"off",inputmode:"decimal"},null,512),[[w,k.value,void 0,{number:!0}]])]),t("div",pt,[e[42]||(e[42]=t("label",{class:"edit-label"},"استراتژی قیمت",-1)),t("div",ct,[t("label",vt,[g(t("input",{type:"radio",value:"like_referrer","onUpdate:modelValue":e[6]||(e[6]=l=>m.value=l)},null,512),[[ee,m.value]]),e[40]||(e[40]=v(" مشابه معرّف ",-1))]),t("label",gt,[g(t("input",{type:"radio",value:"custom","onUpdate:modelValue":e[7]||(e[7]=l=>m.value=l)},null,512),[[ee,m.value]]),e[41]||(e[41]=v(" شخصی‌سازی ",-1))])])]),K.value?(r(),u("div",yt,[e[44]||(e[44]=t("label",{class:"edit-label"},"قیمت‌های شخصی‌سازی",-1)),t("div",xt,[t("div",kt,[g(t("input",{class:"edit-input",type:"text",placeholder:"قیمت تست","onUpdate:modelValue":e[8]||(e[8]=l=>S.value=l),inputmode:"numeric",onInput:e[9]||(e[9]=l=>S.value=V(D(l.target.value)))},null,544),[[w,S.value]])]),t("div",wt,[g(t("input",{class:"edit-input",type:"text",placeholder:"قیمت یک ماهه","onUpdate:modelValue":e[10]||(e[10]=l=>C.value=l),inputmode:"numeric",onInput:e[11]||(e[11]=l=>C.value=V(D(l.target.value)))},null,544),[[w,C.value]])]),t("div",Pt,[g(t("input",{class:"edit-input",type:"text",placeholder:"قیمت سه ماهه","onUpdate:modelValue":e[12]||(e[12]=l=>h.value=l),inputmode:"numeric",onInput:e[13]||(e[13]=l=>h.value=V(D(l.target.value)))},null,544),[[w,h.value]])]),t("div",Nt,[g(t("input",{class:"edit-input",type:"text",placeholder:"قیمت شش ماهه","onUpdate:modelValue":e[14]||(e[14]=l=>I.value=l),inputmode:"numeric",onInput:e[15]||(e[15]=l=>I.value=V(D(l.target.value)))},null,544),[[w,I.value]])]),t("div",zt,[g(t("input",{class:"edit-input",type:"text",placeholder:"قیمت یک ساله","onUpdate:modelValue":e[16]||(e[16]=l=>R.value=l),inputmode:"numeric",onInput:e[17]||(e[17]=l=>R.value=V(D(l.target.value)))},null,544),[[w,R.value]])]),t("div",St,[g(t("input",{class:"edit-input",type:"text",placeholder:"قیمت هر گیگ","onUpdate:modelValue":e[18]||(e[18]=l=>L.value=l),inputmode:"numeric",onInput:e[19]||(e[19]=l=>L.value=V(D(l.target.value)))},null,544),[[w,L.value]])])])])):(r(),u("div",ft,[e[43]||(e[43]=t("label",{class:"edit-label"},"قیمت‌های معرّف",-1)),t("div",mt,[Number(o.value?.pricing_like_referrer?.enable_personalized_price)===1?(r(),u("div",bt," 💰 تست : "+i((o.value.pricing_like_referrer.personalized_price_test||0).toLocaleString("fa-IR"))+" 💰 یک ماهه : "+i((o.value.pricing_like_referrer.personalized_price_1||0).toLocaleString("fa-IR"))+" 💰 سه ماهه : "+i((o.value.pricing_like_referrer.personalized_price_3||0).toLocaleString("fa-IR"))+" 💰 شش ماهه : "+i((o.value.pricing_like_referrer.personalized_price_6||0).toLocaleString("fa-IR"))+" 💰 یک ساله : "+i((o.value.pricing_like_referrer.personalized_price_12||0).toLocaleString("fa-IR"))+" 💰 ترافیک : "+i((o.value.pricing_like_referrer.traffic_price||0).toLocaleString("fa-IR")),1)):(r(),u("div",_t," معرّف شخصی‌سازی ندارد؛ قیمت‌ها بر اساس پیش‌فرض سیستم اعمال می‌شود. "))])])),t("div",Ct,[e[45]||(e[45]=t("div",{class:"edit-label"},null,-1)),t("div",ht,[t("button",{class:"btn-create-user1",disabled:f.value,onClick:fe},"تأیید",8,It),t("button",{class:"btn btn-danger btn-ghost",disabled:f.value,onClick:me},"رد",8,Rt)])])])]),f.value?(r(),u("div",Lt,e[46]||(e[46]=[t("div",{class:"creating-box"},[t("span",null,"... در حال ثبت"),t("i",{class:"fas fa-spinner fa-spin"})],-1)]))):Z("",!0),t("div",Vt,[t("a",{href:"#",onClick:G(T,["prevent"])},"بازگشت")])])])])):Z("",!0)]))]))}},Bt=xe(Dt,[["__scopeId","data-v-307b0015"]]);export{Bt as default};
