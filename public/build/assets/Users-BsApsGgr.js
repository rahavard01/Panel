import{_ as Wt,j as x,r as l,f as Xt,i as ue,a9 as Yt,u as ea,g as rt,w as Z,aa as ut,ab as we,ac as De,e as h,c as u,a as t,l as dt,n as c,m as J,v as _e,b,d as R,F as Fe,s as ta,x as g,t as k,y as ct,q as D,a6 as F,B as aa,T as pt,a7 as sa,ad as na,a8 as vt,ae as la,o,a5 as ft,af as he,ag as mt,ah as oa,ai as bt,aj as yt}from"./app-CRqRyZHt.js";const ia={class:"segmented",dir:"rtl",style:{"margin-bottom":"10px","max-width":"86%"}},ra={class:"table-toolbar",dir:"ltr"},ua={class:"search-field"},da=["placeholder"],ca={align:"center",id:"id",style:{"font-family":"Vazirmatn","font-size":"12px","font-weight":"bold"}},pa={class:"table-shell"},va={class:"table-scroll",role:"region","aria-label":"لیست کاربران",tabindex:"0"},fa={class:"users-table"},ma={class:"th-sort-inner"},ba={key:0},ya={key:1},ga={class:"username-cell"},ka={class:"username-trigger"},xa={class:"username-text"},wa={dir:"rtl"},_a={key:0,style:{"font-weight":"700"}},ha=["innerHTML"],Ca={class:"expiry-date-cell"},$a={dir:"rtl"},Ua={class:"usage-cell"},Ma={class:"usage-top"},Sa={class:"usage-bar"},Pa=["onClick"],Aa={class:"pagination-wrapper",style:{display:"flex","flex-direction":"column","align-items":"center",gap:"6px","margin-top":"28px","font-size":"12px",color:"#d0d0d0"}},Ba={style:{display:"flex","align-items":"center",gap:"10px"}},La=["disabled","aria-disabled"],Ta=["disabled","aria-disabled"],Na={style:{opacity:".7"}},Da=["disabled","aria-disabled"],Fa=["disabled","aria-disabled"],Va={class:"modal-outer"},za={key:0,class:"final-result"},Ea={class:"final-qr"},Ia=["src"],Ra=["title"],qa={class:"final-username"},Oa={class:"fu-value"},ja={class:"create-header"},Ha={class:"segmented"},Qa={key:0,class:"bulk-box"},Za={class:"edit-form"},Ja={key:1,class:"edit-form"},Ka={class:"plans-grid"},Ga=["disabled","aria-disabled"],Wa=["disabled","aria-disabled"],Xa=["disabled","aria-disabled"],Ya=["disabled","aria-disabled"],es=["disabled","aria-disabled"],ts={key:2,class:"plans-grid"},as=["disabled","aria-disabled"],ss={class:"back-button",style:{"text-align":"center","margin-top":"12px"}},ns={key:2,class:"creating-overlay"},ls={class:"modal-outer"},os={class:"final-result"},is={class:"final-qr"},rs=["src"],us=["title"],ds={class:"final-username"},cs={class:"fu-value"},ps={class:"ban-row",dir:"rtl"},vs={class:"ios-toggle"},fs=["disabled"],ms={class:"view-body"},bs={key:0},ys={key:0,class:"view-actions-row"},gs={key:1,class:"view-subpane",style:{"margin-top":"12px"}},ks={class:"plans-grid"},xs={class:"create-actions",style:{"margin-top":"12px"}},ws=["disabled","aria-disabled"],_s={key:0,class:"creating-overlay","aria-live":"polite"},hs={key:2,class:"view-subpane"},Cs={class:"view-bulk-box"},$s={class:"create-actions view-bulk-actions"},Us=["disabled"],Ms={key:0,class:"creating-overlay","aria-live":"polite"},Ss={class:"back-button",style:{"text-align":"center","margin-top":"12px"}},Ps={__name:"Users",setup(As){function de(s){const e=s?.created_at;if(typeof e=="number")return e>1e12?Math.floor(e/1e3):e;if(typeof e=="string"&&e){const a=e.includes("T")?e:e.replace(" ","T"),n=Date.parse(a);if(Number.isFinite(n))return Math.floor(n/1e3)}return Number(s?.id??0)}const Ve=s=>Number(s?._created_ts??de(s)),Ce=(s,e)=>[...s||[]].sort((a,n)=>(e?1:-1)*(Ve(a)-Ve(n))),gt=/^[A-Za-z0-9]{1,32}$/;x(()=>($e?.value||userCode||"").toString()),x(()=>{const s=editForm;return!(!s.current_password||!s.new_password||s.new_password.length<MIN_PW||s.new_password!==s.confirm_password||s.new_password===s.current_password)});const ae=l("admin"),ce=l(""),ze=na(),$e=l(""),Ue=l(""),Me=l([]),Ee=l(""),Se=l(!1),q=l("");function se(s){q.value=s,d.currentPage=1}const Ie=l(!1),V=l(!1),{success:K,error:f,clear:C}=Xt(),ne=l(!1),y=ue({inviteLink:"",email:"",token:"",qrDataUrl:""}),$=ue({part1:"",part2:"",loaded:!1}),U=l(!1),p=ue({email:"",token:"",inviteLink:"",qrDataUrl:""}),G=l(!1),Pe=l(!1),pe=l("");async function ve(){try{if(!localStorage.getItem("token"))return;const e=await h.get("/user/panel");if(e?.data?.status==="error"){localStorage.removeItem("token"),ze.push("/login");return}const a=e?.data?.user;a?.code&&($e.value=a.code.replace(".com","")),!Ue.value&&a?.email&&(Ue.value=a.email),a?.name&&(Ee.value=a.name);let n=[];try{const m=(await h.get("/admin/users"))?.data;Array.isArray(m)?n=m:Array.isArray(m?.data)?n=m.data:Array.isArray(m?.rows)?n=m.rows:Array.isArray(m?.users)&&(n=m.users)}catch(i){console.error("fetch /admin/users failed:",i)}Me.value=(Array.isArray(n)?n:[]).map(i=>({...i,_created_ts:de(i)}))}catch(s){if(s?.response?.status===401){localStorage.removeItem("token"),ze.push("/login");return}console.error("refreshAll failed:",s)}}const{now:kt}=Yt(1e3),W=x(()=>Math.floor(kt.value/1e3)),{poll60:xt}=ea();function wt(){const s=localStorage.getItem("user");if(s)try{const e=JSON.parse(s);Ue.value=e?.email||"",e?.name&&(Ee.value=e.name)}catch{}}rt(async()=>{wt(),await ve(),await Le(),C({immediate:!0})}),Z(xt,()=>ve());const O=l(!1);function _t(){O.value=!O.value,d.currentPage=1}const Re=x(()=>O.value?fe.value:ht.value),fe=x(()=>Ce(Me.value,!0)),ht=x(()=>Ce(Me.value,!1)),me=l(""),X=l(null),Ae=l(!1);function qe(s){if(!s)return null;const e=String(s).trim();if(/^[a-f0-9]{16,64}$/i.test(e)||/^[A-Za-z0-9_-]{16,}$/.test(e))return e;try{const a=new URL(e),n=a.searchParams.get("token");if(n)return n.trim();const i=a.pathname.match(/([A-Za-z0-9_-]{16,})$/);if(i)return i[1]}catch{}return null}async function Ct(s){if(!s){X.value=[];return}Ae.value=!0;try{const a=(await h.get("/users/by-token",{params:{token:s}}))?.data;let n=[];Array.isArray(a)?n=a:Array.isArray(a?.data)?n=a.data:Array.isArray(a?.users)?n=a.users:a&&typeof a=="object"&&a.user&&(n=[a.user]),X.value=n.map(i=>({...i,_created_ts:de(i)}))}catch(e){console.error("fetchUserByToken failed:",e),X.value=[]}finally{Ae.value=!1}}let Oe=null;Z(me,s=>{X.value=null;const e=qe(s);e&&(clearTimeout(Oe),Oe=setTimeout(()=>Ct(e),300))});const je=x(()=>{const s=me.value?.trim()?.toLowerCase()||"",e=qe(s),a=n=>Ce((Array.isArray(n)?n:[]).map(i=>({...i,_created_ts:i._created_ts??de(i)})),O.value);if(e){const n=Array.isArray(X.value)?X.value:[];return a(n)}return s?Re.value.filter(n=>ut(n.email||"").toLowerCase().includes(s)):Re.value}),$t=s=>Number(s?.banned??0)===1||String(s?.banned).toLowerCase()==="true",He=x(()=>{const s=je.value;switch(q.value){case"active":return s.filter(e=>!we(e.expired_at)&&!De(e.expired_at));case"expiring":return s.filter(e=>!we(e.expired_at)&&De(e.expired_at));case"expired":return s.filter(e=>we(e.expired_at));case"banned":return s.filter(e=>$t(e));default:return s}}),d=ue({pageSize:20,currentPage:1}),Be=x(()=>He.value.length),be=x(()=>Math.max(1,Math.ceil(Be.value/d.pageSize)));Z(()=>d.pageSize,()=>{d.currentPage=1}),Z([()=>je.value.length,()=>d.pageSize],()=>{const s=be.value;d.currentPage>s&&(d.currentPage=s)});const Qe=x(()=>{const s=(d.currentPage-1)*d.pageSize,e=s+d.pageSize;return He.value.slice(s,e)}),M=x(()=>d.currentPage===1),S=x(()=>d.currentPage>=be.value);function Ut(){M.value||(d.currentPage=1)}function Mt(){M.value||d.currentPage--}function St(){S.value||d.currentPage++}function Pt(){S.value||(d.currentPage=be.value)}function Ze(s,e=65,a=null){let n=Number(s?.t||0);return n>1e12&&(n=Math.floor(n/1e3)),n?(a??Math.floor(Date.now()/1e3))-n<=e:!1}function At(s,e=null){let a=Number(s?.t||0);if(a>1e12&&(a=Math.floor(a/1e3)),!a)return"نامشخص";const i=(e??Math.floor(Date.now()/1e3))-a,m=Math.max(0,i),H=Math.floor(m/86400),N=Math.floor(m%86400/3600),le=Math.floor(m%3600/60),Ne=m%60;let Q;return H?Q=`${H} روز قبل`:N?Q=`${N} ساعت قبل`:le?Q=`${le} دقیقه قبل`:Q=`${Ne} ثانیه قبل`,`${Q}<br><bdi dir="ltr">${bt(a)}</bdi>`}function ye(s){const e=Number(s?.u||0)+Number(s?.d||0),a=Number(s?.transfer_enable||0);return!a||a<=0?0:e/a*100}const P=l(!1),Bt=x(()=>{try{return typeof P<"u"&&P.value===!0||typeof U<"u"&&U.value===!0}catch{return!1}});Z(Bt,s=>{try{s?document.body.classList.add("modal-open"):document.body.classList.remove("modal-open")}catch{}},{immediate:!0}),rt(()=>{try{typeof P<"u"&&(P.value=!1),typeof U<"u"&&(U.value=!1),document.body.classList.remove("modal-open")}catch{}});const z=l("single"),E=l("test"),_=l(null);Z(z,s=>{s!=="bulk"&&(_.value=null)});async function Je(){at(),await Ge(),U.value=!1,P.value=!0}function ge(){at(),P.value=!1,C({immediate:!0})}function Ke(s){z.value=s}function Y(s){v[s]&&(E.value=s)}function A(s){const e=!v[s];return{cursor:e?"not-allowed":"pointer",opacity:e?.4:.95}}function ee(s){return["btn","green",E.value===s?"selected":""].join(" ")}const v=ue({test:!0,"1m":!0,"1m_noexp":!0,"3m":!0,"6m":!0,"12m":!0});async function Ge(){try{const{data:s}=await h.get("/panel/plans"),e=s?.plan_enabled||{};for(const a of Object.keys(v))Object.prototype.hasOwnProperty.call(e,a)&&(v[a]=!!e[a]);Object.prototype.hasOwnProperty.call(e,"1m_noexp")||(v["1m_noexp"]=!!v["1m"]),E.value&&!v[E.value]&&(E.value=null)}catch{}}async function Lt(){if(!E.value){f("پلن ساخت اکانت را انتخاب کنید");return}V.value=!0;try{const s=z.value==="bulk",e=E.value,a=s?Math.max(2,Math.floor(_.value??2)):1,i={test:"اکانت تست","1m_noexp":"اکانت یک ماهه (بدون تاریخ)","1m":"اکانت یک ماهه","3m":"اکانت سه ماهه","6m":"اکانت شش ماهه","12m":"اکانت یک ساله"}[e]||"پلن منتخب";let m="";if(ae.value==="admin")m=$e.value||"";else{const r=(ce.value||"").trim();if(!r){f("کد اختصاصی را وارد کنید"),V.value=!1;return}if(!gt.test(r)){f("کد اختصاصی وارد شده معتبر نیست"),V.value=!1;return}m=r}const H={panel_code:m,plan_key:e,count:a};if(e==="1m_noexp"&&(H.plan_key="1m",H.no_expire=!0),s){const r=await h.post("/admin/users/create?download_excel=1",H,{responseType:"blob"});if(String(r.headers?.["content-type"]||r.headers?.["Content-Type"]||"").includes("application/json")){const re=await r.data.text().catch(()=>"");try{const Gt=JSON.parse(re||"{}");throw new Error(Gt.message||"ساخت کاربر ناموفق بود")}catch{throw new Error(re||"ساخت کاربر ناموفق بود")}}V.value=!1,typeof ge=="function"?ge():typeof P<"u"?P.value=!1:typeof showCreateModal<"u"&&(showCreateModal.value=!1);const oe=r.headers?.["content-disposition"]||r.headers?.["Content-Disposition"];let lt=`users_${new Date().toISOString().slice(0,19).replace(/[:T]/g,"-")}.xlsx`;if(oe){const re=oe.match(/filename\*?=(?:UTF-8''|")?([^";]+)"?/i);re&&(lt=decodeURIComponent(re[1]))}const Ht=new Blob([r.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),ot=URL.createObjectURL(Ht),ie=document.createElement("a");ie.href=ot,ie.download=lt,document.body.appendChild(ie),ie.click(),ie.remove(),URL.revokeObjectURL(ot);const Qt=r.headers?.["x-created-count"]??r.headers?.["X-Created-Count"],Zt=r.headers?.["x-errors-count"]??r.headers?.["X-Errors-Count"],Jt=Number.parseInt(Qt??String(a),10),it=Number.parseInt(Zt??"0",10),Kt=it?` (با ${it} خطا)`:"";K(`${Jt} عدد ${i} با موفقیت ساخته شد${Kt}`,{mode:"global"}),await ve();return}const{data:N}=await h.post("/admin/users/create",H),le=N?.status==="success"&&Array.isArray(N?.created),Ne=le?N.created.length:0,Q=Array.isArray(N?.errors)?N.errors:[];if(le&&Ne>0){const r=N.created[0]||{};await Le();let te=r.subscribe_url||r.url||r.link||"",oe=r.token||r.sub_token||r.user&&r.user.token||"";te||(te=Xe(oe)),V.value=!1,await vt(),K(`${i} با موفقیت ساخته شد`),y.email=r.email||r.username||"",y.token=oe,y.inviteLink=te,y.qrDataUrl=te?await Ye(te):"",ne.value=!0,U.value=!1,await ve()}else{const r=Q[0]||"ساخت کاربر ناموفق بود";f(r)}}catch(s){if(s?.response?.data instanceof Blob){const e=await s.response.data.text().catch(()=>"");try{const a=JSON.parse(e||"{}");f(a.message||"خطا در ساخت کاربر")}catch{f(e||"خطا در ساخت کاربر")}}else{const e=s?.response?.status,a=s?.response?.data?.message;f(e===422?a||"اعتبار شما کافی نیست":a||s?.message||"خطا در ساخت کاربر")}}finally{V.value=!1}}function Tt(s){const e=s.target.value;if(e===""||e===null){_.value=null;return}const a=Number(e);Number.isFinite(a)?_.value=Math.floor(a):_.value=null}function Nt(){Ie.value=!1,_.value!==null&&_.value<2&&(_.value=2)}function We(s){["e","E","+","-","."," "].includes(s.key)&&s.preventDefault()}async function Le(){if(!$.loaded)try{const{data:s}=await h.get("/settings/link-parts");$.part1=s?.data?.part1||"",$.part2=s?.data?.part2||""}catch{$.part1||($.part1="https://io.subupdatefast.info"),$.part2||($.part2="s")}finally{$.loaded=!0}}function Xe(s){const e=($.part1||"").replace(/\/+$/,""),a=($.part2||"").replace(/^\/+|\/+$/g,"");return!e||!a||!s?"":`${e}/${a}/${s}`}async function Ye(s){if(!s)return"";try{return await la.toDataURL(s,{margin:1,scale:4})}catch{return""}}async function et(s){const e=s??y.inviteLink;if(e)try{await navigator.clipboard.writeText(e),K("لینک کپی شد",{mode:"global"})}catch{f("کپی انجام نشد",{mode:"global"})}}const{formatPrettyUsername:tt}=aa();function Dt(){if(ne.value){ne.value=!1,C({immediate:!0}),vt(()=>{document.querySelector(".create-modal .plans-grid button")?.focus()});return}ge()}function at(){ne.value=!1,y.inviteLink="",y.qrDataUrl="",y.token="",y.email="",E.value=null,z.value="single",_.value=2,V.value=!1,ae.value="admin",ce.value=""}async function Ft(s){try{typeof C=="function"&&C({immediate:!0}),await Ge(),j.value="result",w.value="",T.value=!1,U.value=!0,pe.value="",p.email=s.email,p.expired_at=Number(s?.expired_at||0),p.token="",p.inviteLink="",p.qrDataUrl="",G.value=!!s?.banned,await Le();const e=await h.get("/users/by-email",{params:{email:s.email}}),a=Array.isArray(e?.data?.data)?e.data.data:[];if(!a.length||!a[0]?.token){f("اطلاعات این کاربر یافت نشد");return}const n=a[0].token,i=Xe(n);p.token=n,p.inviteLink=i,p.qrDataUrl=i?await Ye(i):""}catch{f("خطا در دریافت اطلاعات کاربر")}}function st(){U.value=!1,pe.value="",j.value="result",w.value="",T.value=!1,typeof C=="function"&&C({immediate:!0}),nt()}async function Vt(){const s=p.email,e=G.value?1:0;if(s){Pe.value=!0;try{await h.post("/users/ban",{email:s,banned:e}),K(e?"کاربر مسدود شد":"کاربر از وضعیت مسدود خارج شد",{mode:"global"});const a=fe?.value?.find?.(n=>n.email===s)||null;a&&(a.banned=e)}catch(a){G.value=!G.value;const n=a?.response?.status;f(n===403?"اجازهٔ این کار را ندارید":"تغییر وضعیت ناموفق بود",{mode:"global"})}finally{Pe.value=!1}}}const j=l("result"),w=l(""),B=l(!1),L=l(!1),I=l(1),Te=l(!1),ke=l(!1);function zt(){B.value=!B.value,B.value&&(L.value=!1,w.value=""),C({immediate:!0})}function Et(){L.value=!L.value,L.value&&(B.value=!1),C({immediate:!0})}function It(){const s=Math.floor(Number(I.value)||1);I.value=s<1?1:s}function nt(){j.value="result",B.value=!1,L.value=!1,w.value="",I.value=1,Te.value=!1,T.value=!1}function xe(s){w.value=s}function Rt(){if(B.value||L.value){nt(),C({immediate:!0});return}st()}const T=l(!1);function qt(s){return s==="1m"?"یک ماهه":s==="3m"?"سه ماهه":s==="6m"?"شش ماهه":s==="12m"?"یک ساله":""}async function Ot(){if(T.value)return;if(!w.value){f("لطفاً پلن تمدید اکانت را انتخاب کنید");return}const s=w.value;if(s){T.value=!0;try{const{data:e}=await h.post("/admin/users/extend",{email:p.email,period:s});try{if(e?.expired_at){p.expired_at=e.expired_at;const a=fe?.value?.find?.(n=>n.email===p.email);a&&(a.expired_at=e.expired_at)}j.value="result",w.value=""}catch(a){console.warn("post-extend UI update failed:",a)}K(`اکانت با موفقیت ${qt(s)} تمدید شد`)}catch(e){f(e?.response?.data?.message||"تمدید انجام نشد")}finally{T.value=!1,pe.value="",B.value=!1,j.value="result"}}}async function jt(){const s=Math.floor(Number(I.value)||0);if(s<1){f("مقدار ترافیک/گیگ را وارد کنید");return}if(!p?.email){f("ایمیل کاربر نامشخص است");return}ke.value=!0;try{const{data:e}=await h.post("/admin/users/topup",{email:p.email,gb:s});if(typeof e?.d_after<"u"){p.d=Number(e.d_after||0);const a=fe?.value?.find?.(n=>n.email===p.email);a&&(a.d=Number(e.d_after||0))}K(`${s} گیگ ترافیک با موفقیت به اکانت اضافه شد`)}catch(e){const a=e?.response?.data?.message||"خرید ترافیک انجام نشد";f(a)}finally{ke.value=!1,I.value=1,pe.value="",L.value=!1,j.value="result"}}return Z([P,U],([s,e])=>{}),(s,e)=>(o(),u(Fe,null,[e[65]||(e[65]=t("div",{class:"billing-root",dir:"ltr"},[t("h3",{class:"topup-title"},"مدیریت کاربران")],-1)),t("div",{class:"page-actions mobile-only"},[t("button",{class:"btn-create-user2",onClick:Je,type:"button"},e[35]||(e[35]=[t("i",{class:"fas fa-plus"},null,-1),t("span",null,"ساخت کاربر جدید",-1)]))]),t("div",ia,[t("button",{type:"button",class:c(["seg-btn",{active:q.value===""}]),onClick:e[0]||(e[0]=a=>se(""))},"همه",2),t("button",{type:"button",class:c(["seg-btn",{active:q.value==="active"}]),onClick:e[1]||(e[1]=a=>se("active"))},"فعال",2),t("button",{type:"button",class:c(["seg-btn",{active:q.value==="expiring"}]),onClick:e[2]||(e[2]=a=>se("expiring"))},"در حال انقضا",2),t("button",{type:"button",class:c(["seg-btn",{active:q.value==="expired"}]),onClick:e[3]||(e[3]=a=>se("expired"))},"منقضی",2),t("button",{type:"button",class:c(["seg-btn",{active:q.value==="banned"}]),onClick:e[4]||(e[4]=a=>se("banned"))},"مسدود",2)]),t("div",ra,[t("div",ua,[J(t("input",{id:"username",name:"form-control",class:"form-control",type:"text",autocomplete:"off","onUpdate:modelValue":e[5]||(e[5]=a=>me.value=a),placeholder:Se.value?"نام کاربری یا لینک را وارد کنید":"جستجو",onFocus:e[6]||(e[6]=a=>Se.value=!0),onBlur:e[7]||(e[7]=a=>Se.value=!1)},null,40,da),[[_e,me.value]])]),t("div",{class:"toolbar-actions desktop-only"},[t("button",{class:"btn-create-user",onClick:Je,type:"button"},e[36]||(e[36]=[t("i",{class:"fas fa-plus"},null,-1),t("span",null,"ساخت کاربر جدید",-1)]))])]),t("div",ca,[t("div",pa,[t("div",va,[t("table",fa,[t("thead",null,[t("tr",null,[t("th",{onClick:_t,class:"th-sortable"},[t("span",ma,[e[37]||(e[37]=t("span",null,"ردیف",-1)),t("span",{class:c(["caret",{up:O.value,down:!O.value}]),"aria-hidden":"true"},null,2)])]),e[38]||(e[38]=t("th",null,"نام کاربری",-1)),e[39]||(e[39]=t("th",null,"وضعیت",-1)),e[40]||(e[40]=t("th",null,"تاریخ انقضا",-1)),e[41]||(e[41]=t("th",null,"ترافیک مصرفی/ماه",-1)),e[42]||(e[42]=t("th",null," ترافیک کل/ماه",-1)),e[43]||(e[43]=t("th",null," عملیات",-1))])]),t("tbody",null,[Ae.value?(o(),u("tr",ba,e[44]||(e[44]=[t("td",{colspan:7,style:{padding:"14px",color:"#cbd5e1"}},[R(" ... در حال جستجو "),t("i",{class:"fas fa-spinner fa-spin",style:{"margin-left":"8px"}})],-1)]))):Qe.value.length===0?(o(),u("tr",ya,e[45]||(e[45]=[t("td",{colspan:7,style:{padding:"14px",color:"#f50","font-family":"'Vazirmatn Variable', 'Vazirmatn', ui-sans-serif, system-ui, sans-serif"}},[R(" موردی یافت نشد "),t("i",{class:"fas fa-exclamation-triangle",style:{"margin-left":"8px"}})],-1)]))):b("",!0),(o(!0),u(Fe,null,ta(Qe.value,(a,n)=>(o(),u("tr",{key:a.id||`${n}-${a.email}`},[t("td",null,k(O.value?(d.currentPage-1)*d.pageSize+n+1:Be.value-((d.currentPage-1)*d.pageSize+n)),1),t("td",ga,[ft(mt,null,{trigger:he(()=>[t("span",ka,[t("span",{class:c(["presence-dot",{"presence-dot--on":Ze(a,65,W.value)}]),"aria-hidden":"true"},null,2),t("span",xa,k(F(ut)(a.email)),1)])]),content:he(()=>[(o(),u("div",{class:"text-sm",key:W.value},[t("bdi",wa,[Ze(a,65,W.value)?(o(),u("span",_a,"آنلاین")):(o(),u("span",{key:1,innerHTML:"آخرین آنلاین: "+At(a,W.value)},null,8,ha))])]))]),_:2},1024)]),t("td",null,[t("span",{class:c(["badge",a.banned===0?"badge--ok":"badge--ban"])},[t("i",{class:c(a.banned===0?"fas fa-check-circle":"fas fa-ban")},null,2),R(" "+k(a.banned===0?"نرمال":"مسدود"),1)],2)]),t("td",Ca,[ft(mt,null,{trigger:he(()=>[t("span",{class:c(["expiry-badge",{"expiring-red":F(De)(a.expired_at),"expire-red":F(we)(a.expired_at)}])},k(F(bt)(a.expired_at)),3)]),content:he(()=>[(o(),u("div",{class:"text-sm",key:W.value},[t("bdi",$a,k(F(oa)(a.expired_at,W.value)),1)]))]),_:2},1024)]),t("td",Ua,[t("div",Ma,[t("span",null,k(F(yt)(a.u+a.d)),1),t("span",{class:c({"pct-danger":ye(a)>=90})},k(ye(a).toFixed(1))+"% ",3)]),t("div",Sa,[t("div",{class:c(["usage-bar__fill",ye(a)>=90?"is-danger":"is-low"]),style:g({width:Math.min(100,Math.max(0,ye(a))).toFixed(1)+"%"})},null,6)])]),t("td",null,k(F(yt)(a.transfer_enable)),1),t("td",null,[t("button",{type:"button",class:"view-btn view-btn--sm",onClick:i=>Ft(a)}," مشاهده ",8,Pa)])]))),128))])])])]),t("div",Aa,[t("div",Ba,[t("button",{onClick:Ut,disabled:M.value,"aria-disabled":M.value,style:g({background:"#2a2a2a",color:"#fff",border:"1px solid #444",borderRadius:"8px",padding:"4px 10px",cursor:M.value?"not-allowed":"pointer",opacity:M.value?.4:.95})},"⏮︎︎",12,La),t("button",{onClick:Mt,disabled:M.value,"aria-disabled":M.value,style:g({background:"#2a2a2a",color:"#fff",border:"1px solid #444",borderRadius:"8px",padding:"4px 10px",cursor:M.value?"not-allowed":"pointer",opacity:M.value?.4:.95})},e[46]||(e[46]=[t("span",{class:"pagination-icon"},"◀",-1)]),12,Ta),t("span",null,[R(" صفحه "+k(d.currentPage)+" از "+k(be.value)+" ",1),t("span",Na,"( کل کاربران : "+k(Be.value)+" )",1)]),t("button",{onClick:St,disabled:S.value,"aria-disabled":S.value,style:g({background:"#2a2a2a",color:"#fff",border:"1px solid #444",borderRadius:"8px",padding:"4px 10px",cursor:S.value?"not-allowed":"pointer",opacity:S.value?.4:.95})},e[47]||(e[47]=[t("span",{class:"pagination-icon"},"▶",-1)]),12,Da),t("button",{onClick:Pt,disabled:S.value,"aria-disabled":S.value,style:g({background:"#2a2a2a",color:"#fff",border:"1px solid #444",borderRadius:"8px",padding:"4px 10px",cursor:S.value?"not-allowed":"pointer",opacity:S.value?.4:.95})}," ⏭︎︎ ",12,Fa)]),t("div",null,[e[49]||(e[49]=R(" نمایش ",-1)),J(t("select",{"onUpdate:modelValue":e[8]||(e[8]=a=>d.pageSize=a),style:{background:"#2a2a2a",color:"#fff",border:"1px solid #444","border-radius":"6px",padding:"4px 8px",margin:"0 6px"}},e[48]||(e[48]=[t("option",{value:20},"20",-1),t("option",{value:50},"50",-1),t("option",{value:100},"100",-1),t("option",{value:500},"500",-1)]),512),[[ct,d.pageSize,void 0,{number:!0}]]),e[50]||(e[50]=R(" ردیف در هر صفحه ",-1))])])]),(o(),dt(pt,{to:"body"},[P.value?(o(),u("div",{key:0,class:"modal-backdrop",onClick:D(ge,["self"])},[t("div",Va,[t("div",{class:"create-modal",onClick:e[23]||(e[23]=D(()=>{},["stop"]))},[ne.value?(o(),u("div",za,[t("div",Ea,[y.qrDataUrl?(o(),u("img",{key:0,src:y.qrDataUrl,alt:"QR Code"},null,8,Ia)):b("",!0)]),t("button",{type:"button",class:"final-link",onClick:e[9]||(e[9]=a=>et(y.inviteLink)),title:y.inviteLink},[e[51]||(e[51]=t("svg",{class:"ic",viewBox:"0 0 24 24",fill:"none","aria-hidden":"true"},[t("path",{d:"M9 7a2 2 0 0 1 2-2h7a2 2 0 0 1 2 2v7a2 2 0 0 1-2 2h-7a2 2 0 0 1-2-2V7Z",stroke:"currentColor","stroke-width":"1.5"}),t("path",{d:"M7 9H6a2 2 0 0 0-2 2v7a2 2 0 0 0 2 2h7a2 2 0 0 0 2-2v-1",stroke:"currentColor","stroke-width":"1.5"})],-1)),R(" "+k(y.inviteLink),1)],8,Ra),t("div",qa,[t("span",Oa,"USER: "+k(F(tt)(y.email)),1)])])):(o(),u(Fe,{key:1},[t("div",ja,[t("div",Ha,[t("button",{class:c(["seg-btn",{active:z.value==="bulk"}]),type:"button",onClick:e[10]||(e[10]=a=>Ke("bulk"))},"گروهی",2),t("button",{class:c(["seg-btn",{active:z.value==="single"}]),type:"button",onClick:e[11]||(e[11]=a=>Ke("single"))},"تکی",2)])]),z.value==="bulk"?(o(),u("div",Qa,[J(t("input",{class:"bulk-input",type:"number",min:2,step:"1","onUpdate:modelValue":e[12]||(e[12]=a=>_.value=a),placeholder:"۲",onFocus:e[13]||(e[13]=a=>Ie.value=!0),onBlur:Nt,onInput:Tt,onKeydown:We,onWheel:e[14]||(e[14]=D(()=>{},["prevent"])),inputmode:"numeric"},null,544),[[_e,_.value,void 0,{number:!0}]])])):b("",!0),t("div",Za,[J(t("select",{class:"edit-input","onUpdate:modelValue":e[15]||(e[15]=a=>ae.value=a),style:{"min-width":"160px"}},e[52]||(e[52]=[t("option",{value:"admin"},"ساخت با کد پنل ادمین",-1),t("option",{value:"custom"},"ساخت با کد اختصاصی",-1)]),512),[[ct,ae.value]])]),ae.value==="custom"?(o(),u("div",Ja,[J(t("input",{class:"edit-input",style:{width:"160px",margin:"auto"},type:"text","onUpdate:modelValue":e[16]||(e[16]=a=>ce.value=a),placeholder:"ABC123"},null,512),[[_e,ce.value,void 0,{trim:!0}]])])):b("",!0),t("div",Ka,[t("button",{type:"button",class:c([ee("test"),"plan-test"]),disabled:!v.test,"aria-disabled":!v.test,style:g(A("test")),onClick:e[17]||(e[17]=a=>Y("test"))},"اکانت تست",14,Ga),t("button",{type:"button",class:c(ee("3m")),disabled:!v["3m"],"aria-disabled":!v["3m"],style:g(A("3m")),onClick:e[18]||(e[18]=a=>Y("3m"))},"اکانت سه ماهه",14,Wa),t("button",{type:"button",class:c(ee("1m")),disabled:!v["1m"],"aria-disabled":!v["1m"],style:g(A("1m")),onClick:e[19]||(e[19]=a=>Y("1m"))},"اکانت یک ماهه",14,Xa),t("button",{type:"button",class:c(ee("12m")),disabled:!v["12m"],"aria-disabled":!v["12m"],style:g(A("12m")),onClick:e[20]||(e[20]=a=>Y("12m"))},"اکانت یک ساله",14,Ya),t("button",{type:"button",class:c(ee("6m")),disabled:!v["6m"],"aria-disabled":!v["6m"],style:g(A("6m")),onClick:e[21]||(e[21]=a=>Y("6m"))},"اکانت شش ماهه",14,es)]),z.value==="bulk"?(o(),u("div",ts,[t("button",{type:"button",class:c(["plan-test",ee("1m_noexp")]),disabled:!v["1m_noexp"],"aria-disabled":!v["1m_noexp"],style:g(A("1m_noexp")),onClick:e[22]||(e[22]=a=>Y("1m_noexp"))}," اکانت یک ماهه از زمان استفاده ",14,as)])):b("",!0),t("div",{class:"create-actions"},[t("button",{type:"button",class:"btn-create-user1",onClick:Lt},e[53]||(e[53]=[t("span",null,"ساخت",-1)]))])],64)),t("div",ss,[t("a",{href:"#",onClick:D(Dt,["prevent"])},"بازگشت")]),V.value?(o(),u("div",ns,e[54]||(e[54]=[t("div",{class:"creating-box"},[t("span",null,"... در حال ساخت اکانت"),t("i",{class:"fas fa-spinner fa-spin"})],-1)]))):b("",!0)])])])):b("",!0)])),(o(),dt(pt,{to:"body"},[U.value?(o(),u("div",{key:0,class:"modal-backdrop",onClick:D(st,["self"])},[t("div",ls,[t("div",{class:"create-modal",onClick:e[34]||(e[34]=D(()=>{},["stop"]))},[t("div",os,[t("div",is,[p.qrDataUrl?(o(),u("img",{key:0,src:p.qrDataUrl,alt:"QR Code"},null,8,rs)):b("",!0)]),p.inviteLink?(o(),u("button",{key:0,type:"button",class:"final-link",onClick:e[24]||(e[24]=a=>et(p.inviteLink)),title:p.inviteLink},[e[55]||(e[55]=t("svg",{class:"ic",viewBox:"0 0 24 24",fill:"none","aria-hidden":"true"},[t("path",{d:"M9 7a2 2 0 0 1 2-2h7a2 2 0 0 1 2 2v7a2 2 0 0 1-2 2h-7a2 2 0 0 1-2-2V7Z",stroke:"currentColor","stroke-width":"1.5"}),t("path",{d:"M7 9H6a2 2 0 0 0-2 2v7a2 2 0 0 0 2 2h7a2 2 0 0 0 2-2v-1",stroke:"currentColor","stroke-width":"1.5"})],-1)),R(" "+k(p.inviteLink),1)],8,us)):b("",!0),t("div",ds,[t("span",cs,"USER: "+k(F(tt)(p.email)),1)]),e[63]||(e[63]=t("div",{class:"divider-fancy","aria-hidden":"true"},null,-1)),t("div",ps,[e[57]||(e[57]=t("span",{class:"ban-text"},"مسدود کردن کاربر",-1)),t("div",vs,[J(t("input",{id:"view-ban-switch",type:"checkbox","onUpdate:modelValue":e[25]||(e[25]=a=>G.value=a),disabled:Pe.value,onChange:Vt},null,40,fs),[[sa,G.value]]),e[56]||(e[56]=t("label",{for:"view-ban-switch","aria-label":"Toggle user ban"},null,-1))])]),e[64]||(e[64]=t("div",{class:"divider-fancy","aria-hidden":"true"},null,-1)),t("div",ms,[j.value==="result"?(o(),u("div",bs,[!B.value&&!L.value?(o(),u("div",ys,[t("button",{type:"button",class:"view-action-btn is-extend",onClick:Et}," ترافیک اضافه "),t("button",{type:"button",class:"view-action-btn is-extend",onClick:zt}," تمدید اکانت ")])):b("",!0)])):b("",!0),B.value?(o(),u("div",gs,[t("div",ks,[t("button",{type:"button",class:c(["btn","green",{selected:w.value==="3m"}]),style:g(A("3m")),onClick:e[26]||(e[26]=a=>xe("3m"))},"سه ماهه",6),t("button",{type:"button",class:c(["btn","green",{selected:w.value==="1m"}]),style:g(A("1m")),onClick:e[27]||(e[27]=a=>xe("1m"))},"یک ماهه",6),t("button",{type:"button",class:c(["btn","green",{selected:w.value==="12m"}]),style:g(A("12m")),onClick:e[28]||(e[28]=a=>xe("12m"))},"یک ساله",6),t("button",{type:"button",class:c(["btn","green",{selected:w.value==="6m"}]),style:g(A("6m")),onClick:e[29]||(e[29]=a=>xe("6m"))},"شش ماهه",6)]),t("div",xs,[t("button",{type:"button",class:"btn-create-user1",disabled:T.value,"aria-disabled":T.value,onClick:Ot},e[58]||(e[58]=[t("span",null,"تمدید",-1)]),8,ws),T.value?(o(),u("div",_s,e[59]||(e[59]=[t("div",{class:"creating-box"},[t("span",null,"... در حال تمدید"),t("i",{class:"fas fa-spinner fa-spin"})],-1)]))):b("",!0)])])):b("",!0),L.value?(o(),u("div",hs,[t("div",Cs,[J(t("input",{class:"bulk-input view-bulk-input",type:"number",min:1,step:"1","onUpdate:modelValue":e[30]||(e[30]=a=>I.value=a),placeholder:"1",onFocus:e[31]||(e[31]=a=>Te.value=!0),onBlur:e[32]||(e[32]=a=>Te.value=!1),onInput:It,onKeydown:We,onWheel:e[33]||(e[33]=D(()=>{},["prevent"])),inputmode:"numeric"},null,544),[[_e,I.value,void 0,{number:!0}]]),e[60]||(e[60]=t("span",{class:"view-bulk-suffix"},"GB",-1))]),t("div",$s,[t("button",{type:"button",class:"btn-create-user1",disabled:ke.value||!Number(I.value),onClick:D(jt,["prevent"])},e[61]||(e[61]=[t("span",null,"خرید",-1)]),8,Us)]),ke.value?(o(),u("div",Ms,e[62]||(e[62]=[t("div",{class:"creating-box"},[t("span",null,"... در حال خرید ترافیک"),t("i",{class:"fas fa-spinner fa-spin"})],-1)]))):b("",!0)])):b("",!0)])]),t("div",Ss,[t("a",{href:"#",onClick:D(Rt,["prevent"])},"بازگشت")])])])])):b("",!0)]))],64))}},Ls=Wt(Ps,[["__scopeId","data-v-286b911b"]]);export{Ls as default};
