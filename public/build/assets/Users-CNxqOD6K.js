import{_ as Gt,f as x,r as l,u as Wt,e as re,a7 as Xt,b as Yt,d as rt,w as Z,a8 as ut,a9 as we,aa as De,z as C,c as u,a as t,h as dt,n as c,i as J,v as _e,m as b,l as R,F as Fe,p as ea,q as g,t as k,s as ct,k as F,a4 as w,A as ta,T as pt,a5 as aa,ab as sa,a6 as vt,ac as na,o,a3 as ft,ad as he,ae as mt,af as la,ag as bt,ah as yt}from"./app-CMsruCcL.js";const oa={class:"segmented",dir:"rtl",style:{"margin-bottom":"10px","max-width":"86%"}},ia={class:"table-toolbar",dir:"ltr"},ra={class:"search-field"},ua=["placeholder"],da={align:"center",id:"id",style:{"font-family":"Vazirmatn","font-size":"12px","font-weight":"bold"}},ca={class:"table-shell"},pa={class:"table-scroll",role:"region","aria-label":"لیست کاربران",tabindex:"0"},va={class:"users-table"},fa={class:"th-sort-inner"},ma={key:0},ba={key:1},ya={class:"username-cell"},ga={class:"username-trigger"},ka={class:"username-text"},xa={dir:"rtl"},wa={key:0,style:{"font-weight":"700"}},_a=["innerHTML"],ha={class:"expiry-date-cell"},Ca={dir:"rtl"},$a={class:"usage-cell"},Ua={class:"usage-top"},Ma={class:"usage-bar"},Sa=["onClick"],Pa={class:"pagination-wrapper",style:{display:"flex","flex-direction":"column","align-items":"center",gap:"6px","margin-top":"28px","font-size":"12px",color:"#d0d0d0"}},Aa={style:{display:"flex","align-items":"center",gap:"10px"}},La=["disabled","aria-disabled"],Ta=["disabled","aria-disabled"],Ba={style:{opacity:".7"}},Na=["disabled","aria-disabled"],Da=["disabled","aria-disabled"],Fa={class:"modal-outer"},Va={key:0,class:"final-result"},za={class:"final-qr"},Ea=["src"],Ia=["title"],Ra={class:"final-username"},qa={class:"fu-value"},Oa={class:"create-header"},ja={class:"segmented"},Ha={key:0,class:"bulk-box"},Qa={class:"edit-form"},Za={key:1,class:"edit-form"},Ja={class:"plans-grid"},Ka=["disabled","aria-disabled"],Ga=["disabled","aria-disabled"],Wa=["disabled","aria-disabled"],Xa=["disabled","aria-disabled"],Ya=["disabled","aria-disabled"],es={key:2,class:"plans-grid"},ts=["disabled","aria-disabled"],as={class:"back-button",style:{"text-align":"center","margin-top":"12px"}},ss={key:2,class:"creating-overlay"},ns={class:"modal-outer"},ls={class:"final-result"},os={class:"final-qr"},is=["src"],rs=["title"],us={class:"final-username"},ds={class:"fu-value"},cs={class:"ban-row",dir:"rtl"},ps={class:"ios-toggle"},vs=["disabled"],fs={class:"view-body"},ms={key:0},bs={key:0,class:"view-actions-row"},ys={key:1,class:"view-subpane",style:{"margin-top":"12px"}},gs={class:"plans-grid"},ks={class:"create-actions",style:{"margin-top":"12px"}},xs=["disabled","aria-disabled"],ws={key:0,class:"creating-overlay","aria-live":"polite"},_s={key:2,class:"view-subpane"},hs={class:"view-bulk-box"},Cs={class:"create-actions view-bulk-actions"},$s=["disabled"],Us={key:0,class:"creating-overlay","aria-live":"polite"},Ms={class:"back-button",style:{"text-align":"center","margin-top":"12px"}},Ss={__name:"Users",setup(Ps){function ue(s){const e=s?.created_at;if(typeof e=="number")return e>1e12?Math.floor(e/1e3):e;if(typeof e=="string"&&e){const a=e.includes("T")?e:e.replace(" ","T"),n=Date.parse(a);if(Number.isFinite(n))return Math.floor(n/1e3)}return Number(s?.id??0)}const Ve=s=>Number(s?._created_ts??ue(s)),Ce=(s,e)=>[...s||[]].sort((a,n)=>(e?1:-1)*(Ve(a)-Ve(n))),gt=/^[A-Za-z0-9]{1,32}$/;x(()=>($e?.value||userCode||"").toString()),x(()=>{const s=editForm;return!(!s.current_password||!s.new_password||s.new_password.length<MIN_PW||s.new_password!==s.confirm_password||s.new_password===s.current_password)});const te=l("admin"),de=l(""),ze=sa(),$e=l(""),Ue=l(""),Me=l([]),Ee=l(""),Se=l(!1),q=l("");function ae(s){q.value=s,d.currentPage=1}const Ie=l(!1),V=l(!1),{success:K,error:f,clear:$}=Wt(),se=l(!1),y=re({inviteLink:"",email:"",token:"",qrDataUrl:""}),U=re({part1:"",part2:"",loaded:!1}),M=l(!1),p=re({email:"",token:"",inviteLink:"",qrDataUrl:""}),G=l(!1),Pe=l(!1),ce=l("");async function pe(){try{if(!localStorage.getItem("token"))return;const e=await C.get("/user/panel");if(e?.data?.status==="error"){localStorage.removeItem("token"),ze.push("/login");return}const a=e?.data?.user;a?.code&&($e.value=a.code.replace(".com","")),!Ue.value&&a?.email&&(Ue.value=a.email),a?.name&&(Ee.value=a.name);let n=[];try{const m=(await C.get("/admin/users"))?.data;Array.isArray(m)?n=m:Array.isArray(m?.data)?n=m.data:Array.isArray(m?.rows)?n=m.rows:Array.isArray(m?.users)&&(n=m.users)}catch(i){console.error("fetch /admin/users failed:",i)}Me.value=(Array.isArray(n)?n:[]).map(i=>({...i,_created_ts:ue(i)}))}catch(s){if(s?.response?.status===401){localStorage.removeItem("token"),ze.push("/login");return}console.error("refreshAll failed:",s)}}const{now:ve}=Xt(1e3),{poll60:kt}=Yt();function xt(){const s=localStorage.getItem("user");if(s)try{const e=JSON.parse(s);Ue.value=e?.email||"",e?.name&&(Ee.value=e.name)}catch{}}rt(async()=>{xt(),await pe(),await Te(),$({immediate:!0})}),Z(kt,()=>pe());const O=l(!1);function wt(){O.value=!O.value,d.currentPage=1}const Re=x(()=>O.value?fe.value:_t.value),fe=x(()=>Ce(Me.value,!0)),_t=x(()=>Ce(Me.value,!1)),me=l(""),W=l(null),Ae=l(!1);function qe(s){if(!s)return null;const e=String(s).trim();if(/^[a-f0-9]{16,64}$/i.test(e)||/^[A-Za-z0-9_-]{16,}$/.test(e))return e;try{const a=new URL(e),n=a.searchParams.get("token");if(n)return n.trim();const i=a.pathname.match(/([A-Za-z0-9_-]{16,})$/);if(i)return i[1]}catch{}return null}async function ht(s){if(!s){W.value=[];return}Ae.value=!0;try{const a=(await C.get("/users/by-token",{params:{token:s}}))?.data;let n=[];Array.isArray(a)?n=a:Array.isArray(a?.data)?n=a.data:Array.isArray(a?.users)?n=a.users:a&&typeof a=="object"&&a.user&&(n=[a.user]),W.value=n.map(i=>({...i,_created_ts:ue(i)}))}catch(e){console.error("fetchUserByToken failed:",e),W.value=[]}finally{Ae.value=!1}}let Oe=null;Z(me,s=>{W.value=null;const e=qe(s);e&&(clearTimeout(Oe),Oe=setTimeout(()=>ht(e),300))});const je=x(()=>{const s=me.value?.trim()?.toLowerCase()||"",e=qe(s),a=n=>Ce((Array.isArray(n)?n:[]).map(i=>({...i,_created_ts:i._created_ts??ue(i)})),O.value);if(e){const n=Array.isArray(W.value)?W.value:[];return a(n)}return s?Re.value.filter(n=>ut(n.email||"").toLowerCase().includes(s)):Re.value}),Ct=s=>Number(s?.banned??0)===1||String(s?.banned).toLowerCase()==="true",He=x(()=>{const s=je.value;switch(q.value){case"active":return s.filter(e=>!we(e.expired_at)&&!De(e.expired_at));case"expiring":return s.filter(e=>!we(e.expired_at)&&De(e.expired_at));case"expired":return s.filter(e=>we(e.expired_at));case"banned":return s.filter(e=>Ct(e));default:return s}}),d=re({pageSize:20,currentPage:1}),Le=x(()=>He.value.length),be=x(()=>Math.max(1,Math.ceil(Le.value/d.pageSize)));Z(()=>d.pageSize,()=>{d.currentPage=1}),Z([()=>je.value.length,()=>d.pageSize],()=>{const s=be.value;d.currentPage>s&&(d.currentPage=s)});const Qe=x(()=>{const s=(d.currentPage-1)*d.pageSize,e=s+d.pageSize;return He.value.slice(s,e)}),S=x(()=>d.currentPage===1),P=x(()=>d.currentPage>=be.value);function $t(){S.value||(d.currentPage=1)}function Ut(){S.value||d.currentPage--}function Mt(){P.value||d.currentPage++}function St(){P.value||(d.currentPage=be.value)}function Ze(s,e=60){const a=Number(s?.t||0);return a?Math.floor(Date.now()/1e3)-a<=e:!1}function Pt(s,e=null){const a=Number(s?.t||0);if(!a)return"نامشخص";const i=(e??Math.floor(Date.now()/1e3))-a,m=Math.max(0,i),H=Math.floor(m/86400),D=Math.floor(m%86400/3600),ne=Math.floor(m%3600/60),Ne=m%60;let Q;return H>0?Q=`${H} روز قبل`:D>0?Q=`${D} ساعت قبل`:ne>0?Q=`${ne} دقیقه قبل`:Q=`${Ne} ثانیه قبل`,`${Q}<br><bdi dir="ltr">${bt(a)}</bdi>`}function ye(s){const e=Number(s?.u||0)+Number(s?.d||0),a=Number(s?.transfer_enable||0);return!a||a<=0?0:e/a*100}const A=l(!1),At=x(()=>{try{return typeof A<"u"&&A.value===!0||typeof M<"u"&&M.value===!0}catch{return!1}});Z(At,s=>{try{s?document.body.classList.add("modal-open"):document.body.classList.remove("modal-open")}catch{}},{immediate:!0}),rt(()=>{try{typeof A<"u"&&(A.value=!1),typeof M<"u"&&(M.value=!1),document.body.classList.remove("modal-open")}catch{}});const z=l("single"),E=l("test"),h=l(null);Z(z,s=>{s!=="bulk"&&(h.value=null)});async function Je(){at(),await Ge(),M.value=!1,A.value=!0}function ge(){at(),A.value=!1,$({immediate:!0})}function Ke(s){z.value=s}function X(s){v[s]&&(E.value=s)}function L(s){const e=!v[s];return{cursor:e?"not-allowed":"pointer",opacity:e?.4:.95}}function Y(s){return["btn","green",E.value===s?"selected":""].join(" ")}const v=re({test:!0,"1m":!0,"1m_noexp":!0,"3m":!0,"6m":!0,"12m":!0});async function Ge(){try{const{data:s}=await C.get("/panel/plans"),e=s?.plan_enabled||{};for(const a of Object.keys(v))Object.prototype.hasOwnProperty.call(e,a)&&(v[a]=!!e[a]);Object.prototype.hasOwnProperty.call(e,"1m_noexp")||(v["1m_noexp"]=!!v["1m"]),E.value&&!v[E.value]&&(E.value=null)}catch{}}async function Lt(){if(!E.value){f("پلن ساخت اکانت را انتخاب کنید");return}V.value=!0;try{const s=z.value==="bulk",e=E.value,a=s?h.value??2:1,i={test:"اکانت تست","1m_noexp":"اکانت یک ماهه (بدون تاریخ)","1m":"اکانت یک ماهه","3m":"اکانت سه ماهه","6m":"اکانت شش ماهه","12m":"اکانت یک ساله"}[e]||"پلن منتخب";let m="";if(te.value==="admin")m=$e.value||"";else{const r=(de.value||"").trim();if(!r){f("کد اختصاصی را وارد کنید"),V.value=!1;return}if(!gt.test(r)){f("کد اختصاصی وارد شده معتبر نیست"),V.value=!1;return}m=r}const H={panel_code:m,plan_key:e,count:a};if(e==="1m_noexp"&&(H.plan_key="1m",H.no_expire=!0),s){const r=await C.post("/admin/users/create?download_excel=1",H,{responseType:"blob"});if(String(r.headers?.["content-type"]||r.headers?.["Content-Type"]||"").includes("application/json")){const ie=await r.data.text().catch(()=>"");try{const Kt=JSON.parse(ie||"{}");throw new Error(Kt.message||"ساخت کاربر ناموفق بود")}catch{throw new Error(ie||"ساخت کاربر ناموفق بود")}}V.value=!1,typeof ge=="function"?ge():typeof A<"u"?A.value=!1:typeof showCreateModal<"u"&&(showCreateModal.value=!1);const le=r.headers?.["content-disposition"]||r.headers?.["Content-Disposition"];let lt=`users_${new Date().toISOString().slice(0,19).replace(/[:T]/g,"-")}.xlsx`;if(le){const ie=le.match(/filename\*?=(?:UTF-8''|")?([^";]+)"?/i);ie&&(lt=decodeURIComponent(ie[1]))}const jt=new Blob([r.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),ot=URL.createObjectURL(jt),oe=document.createElement("a");oe.href=ot,oe.download=lt,document.body.appendChild(oe),oe.click(),oe.remove(),URL.revokeObjectURL(ot);const Ht=r.headers?.["x-created-count"]??r.headers?.["X-Created-Count"],Qt=r.headers?.["x-errors-count"]??r.headers?.["X-Errors-Count"],Zt=Number.parseInt(Ht??String(a),10),it=Number.parseInt(Qt??"0",10),Jt=it?` (با ${it} خطا)`:"";K(`${Zt} عدد ${i} با موفقیت ساخته شد${Jt}`,{mode:"global"}),await pe();return}const{data:D}=await C.post("/admin/users/create",H),ne=D?.status==="success"&&Array.isArray(D?.created),Ne=ne?D.created.length:0,Q=Array.isArray(D?.errors)?D.errors:[];if(ne&&Ne>0){const r=D.created[0]||{};await Te();let ee=r.subscribe_url||r.url||r.link||"",le=r.token||r.sub_token||r.user&&r.user.token||"";ee||(ee=Xe(le)),V.value=!1,await vt(),K(`${i} با موفقیت ساخته شد`),y.email=r.email||r.username||"",y.token=le,y.inviteLink=ee,y.qrDataUrl=ee?await Ye(ee):"",se.value=!0,M.value=!1,await pe()}else{const r=Q[0]||"ساخت کاربر ناموفق بود";f(r)}}catch(s){if(s?.response?.data instanceof Blob){const e=await s.response.data.text().catch(()=>"");try{const a=JSON.parse(e||"{}");f(a.message||"خطا در ساخت کاربر")}catch{f(e||"خطا در ساخت کاربر")}}else{const e=s?.response?.status,a=s?.response?.data?.message;f(e===422?a||"اعتبار شما کافی نیست":a||s?.message||"خطا در ساخت کاربر")}}finally{V.value=!1}}function Tt(s){const e=s.target.value;if(e===""||e===null){h.value=null;return}const a=Number(e);Number.isFinite(a)?h.value=Math.max(2,Math.floor(a)):h.value=null}function Bt(){Ie.value=!1,h.value!==null&&h.value<2&&(h.value=2)}function We(s){["e","E","+","-","."," "].includes(s.key)&&s.preventDefault()}async function Te(){if(!U.loaded)try{const{data:s}=await C.get("/settings/link-parts");U.part1=s?.data?.part1||"",U.part2=s?.data?.part2||""}catch{U.part1||(U.part1="https://io.subupdatefast.info"),U.part2||(U.part2="s")}finally{U.loaded=!0}}function Xe(s){const e=(U.part1||"").replace(/\/+$/,""),a=(U.part2||"").replace(/^\/+|\/+$/g,"");return!e||!a||!s?"":`${e}/${a}/${s}`}async function Ye(s){if(!s)return"";try{return await na.toDataURL(s,{margin:1,scale:4})}catch{return""}}async function et(s){const e=s??y.inviteLink;if(e)try{await navigator.clipboard.writeText(e),K("لینک کپی شد",{mode:"global"})}catch{f("کپی انجام نشد",{mode:"global"})}}const{formatPrettyUsername:tt}=ta();function Nt(){if(se.value){se.value=!1,$({immediate:!0}),vt(()=>{document.querySelector(".create-modal .plans-grid button")?.focus()});return}ge()}function at(){se.value=!1,y.inviteLink="",y.qrDataUrl="",y.token="",y.email="",E.value=null,z.value="single",h.value=2,V.value=!1,te.value="admin",de.value=""}async function Dt(s){try{typeof $=="function"&&$({immediate:!0}),await Ge(),j.value="result",_.value="",N.value=!1,M.value=!0,ce.value="",p.email=s.email,p.expired_at=Number(s?.expired_at||0),p.token="",p.inviteLink="",p.qrDataUrl="",G.value=!!s?.banned,await Te();const e=await C.get("/users/by-email",{params:{email:s.email}}),a=Array.isArray(e?.data?.data)?e.data.data:[];if(!a.length||!a[0]?.token){f("اطلاعات این کاربر یافت نشد");return}const n=a[0].token,i=Xe(n);p.token=n,p.inviteLink=i,p.qrDataUrl=i?await Ye(i):""}catch{f("خطا در دریافت اطلاعات کاربر")}}function st(){M.value=!1,ce.value="",j.value="result",_.value="",N.value=!1,typeof $=="function"&&$({immediate:!0}),nt()}async function Ft(){const s=p.email,e=G.value?1:0;if(s){Pe.value=!0;try{await C.post("/users/ban",{email:s,banned:e}),K(e?"کاربر مسدود شد":"کاربر از وضعیت مسدود خارج شد",{mode:"global"});const a=fe?.value?.find?.(n=>n.email===s)||null;a&&(a.banned=e)}catch(a){G.value=!G.value;const n=a?.response?.status;f(n===403?"اجازهٔ این کار را ندارید":"تغییر وضعیت ناموفق بود",{mode:"global"})}finally{Pe.value=!1}}}const j=l("result"),_=l(""),T=l(!1),B=l(!1),I=l(1),Be=l(!1),ke=l(!1);function Vt(){T.value=!T.value,T.value&&(B.value=!1,_.value=""),$({immediate:!0})}function zt(){B.value=!B.value,B.value&&(T.value=!1),$({immediate:!0})}function Et(){const s=Math.floor(Number(I.value)||1);I.value=s<1?1:s}function nt(){j.value="result",T.value=!1,B.value=!1,_.value="",I.value=1,Be.value=!1,N.value=!1}function xe(s){_.value=s}function It(){if(T.value||B.value){nt(),$({immediate:!0});return}st()}const N=l(!1);function Rt(s){return s==="1m"?"یک ماهه":s==="3m"?"سه ماهه":s==="6m"?"شش ماهه":s==="12m"?"یک ساله":""}async function qt(){if(N.value)return;if(!_.value){f("لطفاً پلن تمدید اکانت را انتخاب کنید");return}const s=_.value;if(s){N.value=!0;try{const{data:e}=await C.post("/admin/users/extend",{email:p.email,period:s});try{if(e?.expired_at){p.expired_at=e.expired_at;const a=fe?.value?.find?.(n=>n.email===p.email);a&&(a.expired_at=e.expired_at)}j.value="result",_.value=""}catch(a){console.warn("post-extend UI update failed:",a)}K(`اکانت با موفقیت ${Rt(s)} تمدید شد`)}catch(e){f(e?.response?.data?.message||"تمدید انجام نشد")}finally{N.value=!1,ce.value="",T.value=!1,j.value="result"}}}async function Ot(){const s=Math.floor(Number(I.value)||0);if(s<1){f("مقدار ترافیک/گیگ را وارد کنید");return}if(!p?.email){f("ایمیل کاربر نامشخص است");return}ke.value=!0;try{const{data:e}=await C.post("/admin/users/topup",{email:p.email,gb:s});if(typeof e?.d_after<"u"){p.d=Number(e.d_after||0);const a=fe?.value?.find?.(n=>n.email===p.email);a&&(a.d=Number(e.d_after||0))}K(`${s} گیگ ترافیک با موفقیت به اکانت اضافه شد`)}catch(e){const a=e?.response?.data?.message||"خرید ترافیک انجام نشد";f(a)}finally{ke.value=!1,I.value=1,ce.value="",B.value=!1,j.value="result"}}return Z([A,M],([s,e])=>{}),(s,e)=>(o(),u(Fe,null,[e[65]||(e[65]=t("div",{class:"billing-root",dir:"ltr"},[t("h3",{class:"topup-title"},"مدیریت کاربران")],-1)),t("div",{class:"page-actions mobile-only"},[t("button",{class:"btn-create-user2",onClick:Je,type:"button"},e[35]||(e[35]=[t("i",{class:"fas fa-plus"},null,-1),t("span",null,"ساخت کاربر جدید",-1)]))]),t("div",oa,[t("button",{type:"button",class:c(["seg-btn",{active:q.value===""}]),onClick:e[0]||(e[0]=a=>ae(""))},"همه",2),t("button",{type:"button",class:c(["seg-btn",{active:q.value==="active"}]),onClick:e[1]||(e[1]=a=>ae("active"))},"فعال",2),t("button",{type:"button",class:c(["seg-btn",{active:q.value==="expiring"}]),onClick:e[2]||(e[2]=a=>ae("expiring"))},"در حال انقضا",2),t("button",{type:"button",class:c(["seg-btn",{active:q.value==="expired"}]),onClick:e[3]||(e[3]=a=>ae("expired"))},"منقضی",2),t("button",{type:"button",class:c(["seg-btn",{active:q.value==="banned"}]),onClick:e[4]||(e[4]=a=>ae("banned"))},"مسدود",2)]),t("div",ia,[t("div",ra,[J(t("input",{id:"username",name:"form-control",class:"form-control",type:"text",autocomplete:"off","onUpdate:modelValue":e[5]||(e[5]=a=>me.value=a),placeholder:Se.value?"نام کاربری یا لینک را وارد کنید":"جستجو",onFocus:e[6]||(e[6]=a=>Se.value=!0),onBlur:e[7]||(e[7]=a=>Se.value=!1)},null,40,ua),[[_e,me.value]])]),t("div",{class:"toolbar-actions desktop-only"},[t("button",{class:"btn-create-user",onClick:Je,type:"button"},e[36]||(e[36]=[t("i",{class:"fas fa-plus"},null,-1),t("span",null,"ساخت کاربر جدید",-1)]))])]),t("div",da,[t("div",ca,[t("div",pa,[t("table",va,[t("thead",null,[t("tr",null,[t("th",{onClick:wt,class:"th-sortable"},[t("span",fa,[e[37]||(e[37]=t("span",null,"ردیف",-1)),t("span",{class:c(["caret",{up:O.value,down:!O.value}]),"aria-hidden":"true"},null,2)])]),e[38]||(e[38]=t("th",null,"نام کاربری",-1)),e[39]||(e[39]=t("th",null,"وضعیت",-1)),e[40]||(e[40]=t("th",null,"تاریخ انقضا",-1)),e[41]||(e[41]=t("th",null,"ترافیک مصرفی/ماه",-1)),e[42]||(e[42]=t("th",null," ترافیک کل/ماه",-1)),e[43]||(e[43]=t("th",null," عملیات",-1))])]),t("tbody",null,[Ae.value?(o(),u("tr",ma,e[44]||(e[44]=[t("td",{colspan:7,style:{padding:"14px",color:"#cbd5e1"}},[R(" ... در حال جستجو "),t("i",{class:"fas fa-spinner fa-spin",style:{"margin-left":"8px"}})],-1)]))):Qe.value.length===0?(o(),u("tr",ba,e[45]||(e[45]=[t("td",{colspan:7,style:{padding:"14px",color:"#f50","font-family":"'Vazirmatn Variable', 'Vazirmatn', ui-sans-serif, system-ui, sans-serif"}},[R(" موردی یافت نشد "),t("i",{class:"fas fa-exclamation-triangle",style:{"margin-left":"8px"}})],-1)]))):b("",!0),(o(!0),u(Fe,null,ea(Qe.value,(a,n)=>(o(),u("tr",{key:a.id||`${n}-${a.email}`},[t("td",null,k(O.value?(d.currentPage-1)*d.pageSize+n+1:Le.value-((d.currentPage-1)*d.pageSize+n)),1),t("td",ya,[ft(mt,null,{trigger:he(()=>[t("span",ga,[t("span",{class:c(["presence-dot",{"presence-dot--on":Ze(a)}]),"aria-hidden":"true"},null,2),t("span",ka,k(w(ut)(a.email)),1)])]),content:he(()=>[(o(),u("div",{class:"text-sm",key:Math.floor(w(ve)/1e3)},[t("bdi",xa,[Ze(a)?(o(),u("span",wa,"آنلاین")):(o(),u("span",{key:1,innerHTML:"آخرین آنلاین: "+Pt(a,Math.floor(w(ve)/1e3))},null,8,_a))])]))]),_:2},1024)]),t("td",null,[t("span",{class:c(["badge",a.banned===0?"badge--ok":"badge--ban"])},[t("i",{class:c(a.banned===0?"fas fa-check-circle":"fas fa-ban")},null,2),R(" "+k(a.banned===0?"نرمال":"مسدود"),1)],2)]),t("td",ha,[ft(mt,null,{trigger:he(()=>[t("span",{class:c(["expiry-badge",{"expiring-red":w(De)(a.expired_at),"expire-red":w(we)(a.expired_at)}])},k(w(bt)(a.expired_at)),3)]),content:he(()=>[(o(),u("div",{class:"text-sm",key:Math.floor(w(ve)/1e3)},[t("bdi",Ca,k(w(la)(a.expired_at,Math.floor(w(ve)/1e3))),1)]))]),_:2},1024)]),t("td",$a,[t("div",Ua,[t("span",null,k(w(yt)(a.u+a.d)),1),t("span",{class:c({"pct-danger":ye(a)>=90})},k(ye(a).toFixed(1))+"% ",3)]),t("div",Ma,[t("div",{class:c(["usage-bar__fill",ye(a)>=90?"is-danger":"is-low"]),style:g({width:Math.min(100,Math.max(0,ye(a))).toFixed(1)+"%"})},null,6)])]),t("td",null,k(w(yt)(a.transfer_enable)),1),t("td",null,[t("button",{type:"button",class:"view-btn view-btn--sm",onClick:i=>Dt(a)}," مشاهده ",8,Sa)])]))),128))])])])]),t("div",Pa,[t("div",Aa,[t("button",{onClick:$t,disabled:S.value,"aria-disabled":S.value,style:g({background:"#2a2a2a",color:"#fff",border:"1px solid #444",borderRadius:"8px",padding:"4px 10px",cursor:S.value?"not-allowed":"pointer",opacity:S.value?.4:.95})},"⏮︎︎",12,La),t("button",{onClick:Ut,disabled:S.value,"aria-disabled":S.value,style:g({background:"#2a2a2a",color:"#fff",border:"1px solid #444",borderRadius:"8px",padding:"4px 10px",cursor:S.value?"not-allowed":"pointer",opacity:S.value?.4:.95})},e[46]||(e[46]=[t("span",{class:"pagination-icon"},"◀",-1)]),12,Ta),t("span",null,[R(" صفحه "+k(d.currentPage)+" از "+k(be.value)+" ",1),t("span",Ba,"( کل کاربران : "+k(Le.value)+" )",1)]),t("button",{onClick:Mt,disabled:P.value,"aria-disabled":P.value,style:g({background:"#2a2a2a",color:"#fff",border:"1px solid #444",borderRadius:"8px",padding:"4px 10px",cursor:P.value?"not-allowed":"pointer",opacity:P.value?.4:.95})},e[47]||(e[47]=[t("span",{class:"pagination-icon"},"▶",-1)]),12,Na),t("button",{onClick:St,disabled:P.value,"aria-disabled":P.value,style:g({background:"#2a2a2a",color:"#fff",border:"1px solid #444",borderRadius:"8px",padding:"4px 10px",cursor:P.value?"not-allowed":"pointer",opacity:P.value?.4:.95})}," ⏭︎︎ ",12,Da)]),t("div",null,[e[49]||(e[49]=R(" نمایش ",-1)),J(t("select",{"onUpdate:modelValue":e[8]||(e[8]=a=>d.pageSize=a),style:{background:"#2a2a2a",color:"#fff",border:"1px solid #444","border-radius":"6px",padding:"4px 8px",margin:"0 6px"}},e[48]||(e[48]=[t("option",{value:20},"20",-1),t("option",{value:50},"50",-1),t("option",{value:100},"100",-1),t("option",{value:500},"500",-1)]),512),[[ct,d.pageSize,void 0,{number:!0}]]),e[50]||(e[50]=R(" ردیف در هر صفحه ",-1))])])]),(o(),dt(pt,{to:"body"},[A.value?(o(),u("div",{key:0,class:"modal-backdrop",onClick:F(ge,["self"])},[t("div",Fa,[t("div",{class:"create-modal",onClick:e[23]||(e[23]=F(()=>{},["stop"]))},[se.value?(o(),u("div",Va,[t("div",za,[y.qrDataUrl?(o(),u("img",{key:0,src:y.qrDataUrl,alt:"QR Code"},null,8,Ea)):b("",!0)]),t("button",{type:"button",class:"final-link",onClick:e[9]||(e[9]=a=>et(y.inviteLink)),title:y.inviteLink},[e[51]||(e[51]=t("svg",{class:"ic",viewBox:"0 0 24 24",fill:"none","aria-hidden":"true"},[t("path",{d:"M9 7a2 2 0 0 1 2-2h7a2 2 0 0 1 2 2v7a2 2 0 0 1-2 2h-7a2 2 0 0 1-2-2V7Z",stroke:"currentColor","stroke-width":"1.5"}),t("path",{d:"M7 9H6a2 2 0 0 0-2 2v7a2 2 0 0 0 2 2h7a2 2 0 0 0 2-2v-1",stroke:"currentColor","stroke-width":"1.5"})],-1)),R(" "+k(y.inviteLink),1)],8,Ia),t("div",Ra,[t("span",qa,"USER: "+k(w(tt)(y.email)),1)])])):(o(),u(Fe,{key:1},[t("div",Oa,[t("div",ja,[t("button",{class:c(["seg-btn",{active:z.value==="bulk"}]),type:"button",onClick:e[10]||(e[10]=a=>Ke("bulk"))},"گروهی",2),t("button",{class:c(["seg-btn",{active:z.value==="single"}]),type:"button",onClick:e[11]||(e[11]=a=>Ke("single"))},"تکی",2)])]),z.value==="bulk"?(o(),u("div",Ha,[J(t("input",{class:"bulk-input",type:"number",min:2,step:"1","onUpdate:modelValue":e[12]||(e[12]=a=>h.value=a),placeholder:"۲",onFocus:e[13]||(e[13]=a=>Ie.value=!0),onBlur:Bt,onInput:Tt,onKeydown:We,onWheel:e[14]||(e[14]=F(()=>{},["prevent"])),inputmode:"numeric"},null,544),[[_e,h.value,void 0,{number:!0}]])])):b("",!0),t("div",Qa,[J(t("select",{class:"edit-input","onUpdate:modelValue":e[15]||(e[15]=a=>te.value=a),style:{"min-width":"160px"}},e[52]||(e[52]=[t("option",{value:"admin"},"ساخت با کد پنل ادمین",-1),t("option",{value:"custom"},"ساخت با کد اختصاصی",-1)]),512),[[ct,te.value]])]),te.value==="custom"?(o(),u("div",Za,[J(t("input",{class:"edit-input",type:"text","onUpdate:modelValue":e[16]||(e[16]=a=>de.value=a),placeholder:"ABC123"},null,512),[[_e,de.value,void 0,{trim:!0}]])])):b("",!0),t("div",Ja,[t("button",{type:"button",class:c([Y("test"),"plan-test"]),disabled:!v.test,"aria-disabled":!v.test,style:g(L("test")),onClick:e[17]||(e[17]=a=>X("test"))},"اکانت تست",14,Ka),t("button",{type:"button",class:c(Y("3m")),disabled:!v["3m"],"aria-disabled":!v["3m"],style:g(L("3m")),onClick:e[18]||(e[18]=a=>X("3m"))},"اکانت سه ماهه",14,Ga),t("button",{type:"button",class:c(Y("1m")),disabled:!v["1m"],"aria-disabled":!v["1m"],style:g(L("1m")),onClick:e[19]||(e[19]=a=>X("1m"))},"اکانت یک ماهه",14,Wa),t("button",{type:"button",class:c(Y("12m")),disabled:!v["12m"],"aria-disabled":!v["12m"],style:g(L("12m")),onClick:e[20]||(e[20]=a=>X("12m"))},"اکانت یک ساله",14,Xa),t("button",{type:"button",class:c(Y("6m")),disabled:!v["6m"],"aria-disabled":!v["6m"],style:g(L("6m")),onClick:e[21]||(e[21]=a=>X("6m"))},"اکانت شش ماهه",14,Ya)]),z.value==="bulk"?(o(),u("div",es,[t("button",{type:"button",class:c(["plan-test",Y("1m_noexp")]),disabled:!v["1m_noexp"],"aria-disabled":!v["1m_noexp"],style:g(L("1m_noexp")),onClick:e[22]||(e[22]=a=>X("1m_noexp"))}," اکانت یک ماهه از زمان استفاده ",14,ts)])):b("",!0),t("div",{class:"create-actions"},[t("button",{type:"button",class:"btn-create-user1",onClick:Lt},e[53]||(e[53]=[t("span",null,"ساخت",-1)]))])],64)),t("div",as,[t("a",{href:"#",onClick:F(Nt,["prevent"])},"بازگشت")]),V.value?(o(),u("div",ss,e[54]||(e[54]=[t("div",{class:"creating-box"},[t("span",null,"... در حال ساخت اکانت"),t("i",{class:"fas fa-spinner fa-spin"})],-1)]))):b("",!0)])])])):b("",!0)])),(o(),dt(pt,{to:"body"},[M.value?(o(),u("div",{key:0,class:"modal-backdrop",onClick:F(st,["self"])},[t("div",ns,[t("div",{class:"create-modal",onClick:e[34]||(e[34]=F(()=>{},["stop"]))},[t("div",ls,[t("div",os,[p.qrDataUrl?(o(),u("img",{key:0,src:p.qrDataUrl,alt:"QR Code"},null,8,is)):b("",!0)]),p.inviteLink?(o(),u("button",{key:0,type:"button",class:"final-link",onClick:e[24]||(e[24]=a=>et(p.inviteLink)),title:p.inviteLink},[e[55]||(e[55]=t("svg",{class:"ic",viewBox:"0 0 24 24",fill:"none","aria-hidden":"true"},[t("path",{d:"M9 7a2 2 0 0 1 2-2h7a2 2 0 0 1 2 2v7a2 2 0 0 1-2 2h-7a2 2 0 0 1-2-2V7Z",stroke:"currentColor","stroke-width":"1.5"}),t("path",{d:"M7 9H6a2 2 0 0 0-2 2v7a2 2 0 0 0 2 2h7a2 2 0 0 0 2-2v-1",stroke:"currentColor","stroke-width":"1.5"})],-1)),R(" "+k(p.inviteLink),1)],8,rs)):b("",!0),t("div",us,[t("span",ds,"USER: "+k(w(tt)(p.email)),1)]),e[63]||(e[63]=t("div",{class:"divider-fancy","aria-hidden":"true"},null,-1)),t("div",cs,[e[57]||(e[57]=t("span",{class:"ban-text"},"مسدود کردن کاربر",-1)),t("div",ps,[J(t("input",{id:"view-ban-switch",type:"checkbox","onUpdate:modelValue":e[25]||(e[25]=a=>G.value=a),disabled:Pe.value,onChange:Ft},null,40,vs),[[aa,G.value]]),e[56]||(e[56]=t("label",{for:"view-ban-switch","aria-label":"Toggle user ban"},null,-1))])]),e[64]||(e[64]=t("div",{class:"divider-fancy","aria-hidden":"true"},null,-1)),t("div",fs,[j.value==="result"?(o(),u("div",ms,[!T.value&&!B.value?(o(),u("div",bs,[t("button",{type:"button",class:"view-action-btn is-extend",onClick:zt}," ترافیک اضافه "),t("button",{type:"button",class:"view-action-btn is-extend",onClick:Vt}," تمدید اکانت ")])):b("",!0)])):b("",!0),T.value?(o(),u("div",ys,[t("div",gs,[t("button",{type:"button",class:c(["btn","green",{selected:_.value==="3m"}]),style:g(L("3m")),onClick:e[26]||(e[26]=a=>xe("3m"))},"سه ماهه",6),t("button",{type:"button",class:c(["btn","green",{selected:_.value==="1m"}]),style:g(L("1m")),onClick:e[27]||(e[27]=a=>xe("1m"))},"یک ماهه",6),t("button",{type:"button",class:c(["btn","green",{selected:_.value==="12m"}]),style:g(L("12m")),onClick:e[28]||(e[28]=a=>xe("12m"))},"یک ساله",6),t("button",{type:"button",class:c(["btn","green",{selected:_.value==="6m"}]),style:g(L("6m")),onClick:e[29]||(e[29]=a=>xe("6m"))},"شش ماهه",6)]),t("div",ks,[t("button",{type:"button",class:"btn-create-user1",disabled:N.value,"aria-disabled":N.value,onClick:qt},e[58]||(e[58]=[t("span",null,"تمدید",-1)]),8,xs),N.value?(o(),u("div",ws,e[59]||(e[59]=[t("div",{class:"creating-box"},[t("span",null,"... در حال تمدید"),t("i",{class:"fas fa-spinner fa-spin"})],-1)]))):b("",!0)])])):b("",!0),B.value?(o(),u("div",_s,[t("div",hs,[J(t("input",{class:"bulk-input view-bulk-input",type:"number",min:1,step:"1","onUpdate:modelValue":e[30]||(e[30]=a=>I.value=a),placeholder:"1",onFocus:e[31]||(e[31]=a=>Be.value=!0),onBlur:e[32]||(e[32]=a=>Be.value=!1),onInput:Et,onKeydown:We,onWheel:e[33]||(e[33]=F(()=>{},["prevent"])),inputmode:"numeric"},null,544),[[_e,I.value,void 0,{number:!0}]]),e[60]||(e[60]=t("span",{class:"view-bulk-suffix"},"GB",-1))]),t("div",Cs,[t("button",{type:"button",class:"btn-create-user1",disabled:ke.value||!Number(I.value),onClick:F(Ot,["prevent"])},e[61]||(e[61]=[t("span",null,"خرید",-1)]),8,$s)]),ke.value?(o(),u("div",Us,e[62]||(e[62]=[t("div",{class:"creating-box"},[t("span",null,"... در حال خرید ترافیک"),t("i",{class:"fas fa-spinner fa-spin"})],-1)]))):b("",!0)])):b("",!0)])]),t("div",Ms,[t("a",{href:"#",onClick:F(It,["prevent"])},"بازگشت")])])])])):b("",!0)]))],64))}},Ls=Gt(Ss,[["__scopeId","data-v-7b262bba"]]);export{Ls as default};
