import{_ as X,u as Y,r as H,e as k,d as y,c as u,a as e,m as Z,n as m,i as c,ai as g,aj as ee,F as M,p as T,y as R,v as _,l as te,z as p,o as f,t as W,s as se,a5 as ae}from"./app-DPZTFWU6.js";const ne={class:"section-wrap",dir:"rtl"},le={class:"final-result settings-final"},ie={class:"settings-stack"},de=["aria-expanded"],oe={class:"settings-card__body"},re={class:"tariff-table"},ce={class:"td td-label"},ue={class:"td td-price","data-label":"قیمت"},fe=["value","onInput"],pe={key:0,class:"td td-desc","data-label":"توضیحات"},me=["onUpdate:modelValue"],ve={key:1,class:"td td-desc empty"},be={key:2,class:"td td-link","data-label":"پلن متصل به پنل"},ge=["onUpdate:modelValue"],_e=["value"],ke={key:3,class:"td td-link empty"},ye={key:4,class:"td td-status","data-label":"وضعیت (فعال / غیرفعال)"},he={class:"switch-line ios"},we=["id","onUpdate:modelValue","onChange"],xe={key:5,class:"td td-status empty"},Ce={class:"bulk-box"},Pe={class:"bulk-row one-line"},Ve={class:"bulk-radio"},Ne={class:"radio"},Se={class:"radio"},Ue={class:"bulk-inline"},$e={class:"bulk-percent"},Le=["aria-expanded"],De={class:"settings-card__body"},Ie={class:"tariff-table"},Be={class:"tr simple"},Ee={class:"td"},He={class:"tr simple"},Me={class:"td"},Te=["value"],Re=["aria-expanded"],We={class:"settings-card__body"},je={class:"tariff-table"},ze={class:"tr simple"},Fe={class:"td"},Oe=["aria-expanded"],Ae={class:"settings-card__body"},Ke={class:"tariff-table"},qe={class:"tr simple"},Ge={class:"td"},Je={class:"page-actions",style:{"margin-top":"12px"}},Qe=["disabled"],Xe=["disabled"],Ye=["aria-expanded"],Ze={class:"settings-card__body"},et={key:0,class:"creating-overlay","aria-live":"polite",dir:"ltr"},tt={class:"page-actions",style:{"margin-top":"14px"}},st=["disabled"],at={__name:"Settings",setup(nt){const{success:v,error:o}=Y(),S=H([{id:"",label:"— انتخاب کنید —"}]),r=H(!1),i=k({tariffs:!1,card:!1,commission:!1,telegramPartners:!1,telegramNotify:!1}),n=k({telegramNotify:{token:"",channel_id:"",admin_ids:""},telegramPartners:{token:""},card:{holder:"",card_number:""},commission:{default_percent:10}});function b(s){i[s]=!i[s]}const j=k([{key:"gig",label:"هر گیگ ترافیک",allowLink:!1,price:null},{key:"test",label:"اکانت تست",allowLink:!0,price:null,description:"",linked_plan_id:"",enabled:!0},{key:"1m",label:"اکانت یک ماهه",allowLink:!0,price:null,description:"",linked_plan_id:"",enabled:!0},{key:"3m",label:"اکانت سه ماهه",allowLink:!0,price:null,description:"",linked_plan_id:"",enabled:!0},{key:"6m",label:"اکانت شش ماهه",allowLink:!0,price:null,description:"",linked_plan_id:"",enabled:!0},{key:"12m",label:"اکانت یک ساله",allowLink:!0,price:null,description:"",linked_plan_id:"",enabled:!0}]);n.tariffs=k({items:j,bulk:{direction:"increase",percent:null}});async function z(){try{if(r.value=!0,!n.tariffs.items.every(d=>d.price!==null&&d.price!=="")){o("قیمت کلیه پلن‌ها را وارد کنید"),r.value=!1;return}if(!n.tariffs.items.filter(d=>d.key!=="gig").every(d=>d.description&&d.description.trim().length>0)){o("توضیحات کلیه پلن‌ها را وارد کنید"),r.value=!1;return}if(!n.tariffs.items.filter(d=>d.key!=="gig").every(d=>d.linked_plan_id)){o("پلن متصل به پنل را برای کلیه پلن‌ها انتخاب کنید"),r.value=!1;return}const l={items:n.tariffs.items.map(d=>({plan_key:d.key,default_price:String(d.price??""),details:d.key==="gig"?"":d.description??"",v2_plan_id:d.key==="gig"?null:d.linked_plan_id||null}))},{data:w}=await p.put("/admin/tariffs",l);if(w.status!=="ok"){o(w.message||"خطا در ذخیره تنظیمات تعرفه"),r.value=!1;return}let I=!1;const x=n.tariffs.bulk.direction,B=Number(n.tariffs.bulk.percent||0);if(B>0&&(x==="increase"||x==="decrease")){const{data:d}=await p.post("/admin/tariffs/percent-adjust",{mode:x,percent:B});if(d.status!=="ok"){o(d.message||"خطا در اعمال درصد"),r.value=!1;return}I=!!d.changed}const E=(n.card.holder||"").trim(),C=String(n.card.card_number||"").replace(/\D+/g,"");if(E===""){o("نام صاحب کارت را وارد کنید"),r.value=!1;return}if(C===""){o("شماره کارت را وارد کنید"),r.value=!1;return}if(C.length!==16){o("شماره کارت باید 16 رقم باشد"),r.value=!1;return}const{data:P}=await p.put("/admin/card-settings",{holder:E,card_number:C});if(P.status!=="ok"){o(P.message||"خطا در ذخیره تنظیمات کارت"),r.value=!1;return}const V=n.commission.default_percent;if(V==null||String(V).trim()===""){o("مقدار درصد پیش فرض کمیسیون را وارد کنید"),r.value=!1;return}const{data:N}=await p.put("/admin/commission-settings",{default_percent:n.commission.default_percent});if(N.status!=="ok"){o(N.message||"خطا در ذخیره تنظیمات کمیسیون"),r.value=!1;return}const Q=!!(w.changed||I||P.changed||N.changed);v(Q?"تغییرات با موفقیت ذخیره شد":"تغییری اعمال نشد"),await U(),await $(),typeof h=="function"&&await h(),n.tariffs.bulk.percent=null}catch{o("خطای غیرمنتظره در ذخیره")}finally{r.value=!1}}function F(s){if(!s)return"";const t=s.trim();return t.length<=8?t[0]+"••"+t.slice(-1):t.slice(0,4)+"••••••"+t.slice(-4)}async function O(){const s=(n.telegramPartners.token||"").trim();if(!s){o("توکن ربات همکاران را وارد کنید");return}if(s.includes("•")){o("توکن ماسک‌شده قابل ارسال نیست؛ لطفاً توکن واقعی را وارد کنید");return}r.value=!0;try{await p.post("/admin/bot/set-webhook",{token:s}),v("تنظیمات ربات با موفقیت انجام شد"),n.telegramPartners.token=F(s)}catch(t){const a=t?.response?.data?.message||"خطا در تنظیم وبهوک";o(a)}finally{r.value=!1}}async function A(){r.value=!0;try{await p.post("/admin/bot/remove-webhook"),v("تنظیمات ربات تلگرام همکاران با موفقیت حذف شد"),n.telegramPartners.token=""}catch(s){const t=s?.response?.data?.message||"خطا در حذف وبهوک";o(t)}finally{r.value=!1}}async function U(){try{const{data:s}=await p.get("/admin/tariffs");if(s.status!=="ok")throw new Error("failed");S.value=[{id:"",label:"— انتخاب کنید —"},...s.v2_options];const t=Object.fromEntries(s.items.map(a=>[a.plan_key,a]));for(const a of n.tariffs.items){const l=t[a.key];l&&(a.price=l.default_price?Number(l.default_price):null,a.description=l.details||"",a.linked_plan_id=l.v2_plan_id||"",a.enabled=!!l.enable)}}catch{o("خطا در دریافت تنظیمات تعرفه")}}async function $(){try{const{data:s}=await p.get("/admin/card-settings");if(s.status!=="ok")throw new Error("failed");n.card.holder=s.data.holder||"",n.card.card_number=String(s.data.card_number||"").replace(/\D+/g,"").slice(0,16)}catch{o("خطا در دریافت تنظیمات کارت")}}async function K(){try{const{data:s}=await p.get("/admin/bot/status");s?.token_preview?n.telegramPartners.token=s.token_preview:n.telegramPartners.token=""}catch{}}async function h(){try{const{data:s}=await p.get("/admin/commission-settings");if(s.status!=="ok")throw new Error("failed");const t=s.data?.default_percent??"";n.commission.default_percent=t===""?null:Number(t)}catch{o("خطا در دریافت تنظیمات کمیسیون")}}y(U),y($),y(K),y(h);async function q(s){try{const{data:t}=await p.patch(`/admin/tariffs/${encodeURIComponent(s.key)}/enable`,{enable:s.enabled?1:0});if(t.status!=="ok"){o(t.message||"خطا در تغییر وضعیت"),s.enabled=!s.enabled;return}v(t.message||(s.enabled?"پلن با موفقیت فعال شد":"پلن با موفقیت غیرفعال شد"))}catch{o("خطا در تغییر وضعیت"),s.enabled=!s.enabled}}function L(s){return s==null||s===""?"":String(Math.trunc(Number(s))).replace(/[^\d]/g,"").replace(/\B(?=(\d{3})+(?!\d))/g,",")}function G(s,t){const l=(t.target.value||"").replace(/[^\d]/g,"");s.price=l===""?null:Number(l),t.target.value=L(l)}function D(s){return String(s||"").replace(/\D/g,"").slice(0,16).replace(/(.{4})/g,"$1-").replace(/-$/,"")}function J(s){const a=(s.target.value||"").replace(/\D/g,"").slice(0,16);n.card.card_number=a,s.target.value=D(a)}return(s,t)=>(f(),u("div",ne,[t[31]||(t[31]=e("div",{class:"billing-root",dir:"ltr"},[e("h3",{class:"topup-title"},"تنظیمات پنل")],-1)),e("div",le,[e("div",ie,[e("section",{class:m(["settings-card",{open:i.tariffs}])},[e("header",{class:"settings-card__header",onClick:t[0]||(t[0]=a=>b("tariffs"))},[t[11]||(t[11]=e("div",{class:"h-left"},[e("i",{class:"fas fa-tags"}),e("span",null,"تنظیمات تعرفه‌ ها"),e("small",null,"تعرفه های پیش فرض / افزایش یا کاهش ")],-1)),e("button",{type:"button",class:"chev-btn","aria-expanded":i.tariffs},[e("i",{class:m(["fas",i.tariffs?"fa-chevron-up":"fa-chevron-down"])},null,2)],8,de)]),c(e("div",oe,[e("div",re,[t[12]||(t[12]=ee('<div class="tr head" data-v-9d61cf88><div class="td h-label" data-v-9d61cf88>عنوان</div><div class="td h-price" data-v-9d61cf88>قیمت</div><div class="td h-desc" data-v-9d61cf88>توضیحات پلن</div><div class="td h-link" data-v-9d61cf88>پلن متصل به پنل</div><div class="td h-status" data-v-9d61cf88> وضعیت <small class="status-hint" data-v-9d61cf88> (فعال / غیرفعال) </small></div></div>',1)),(f(!0),u(M,null,T(n.tariffs.items,a=>(f(),u("div",{class:"tr",key:a.key},[e("div",ce,W(a.label),1),e("div",ue,[e("input",{class:"form-input",type:"text",inputmode:"numeric",value:L(a.price),onInput:l=>G(a,l),placeholder:"تومان"},null,40,fe)]),a.key!=="gig"?(f(),u("div",pe,[c(e("input",{class:"form-input",type:"text","onUpdate:modelValue":l=>a.description=l,placeholder:"جهت نمایش در جدول تعرفه ها"},null,8,me),[[_,a.description,void 0,{trim:!0}]])])):(f(),u("div",ve)),a.allowLink?(f(),u("div",be,[c(e("select",{class:"form-input","onUpdate:modelValue":l=>a.linked_plan_id=l},[(f(!0),u(M,null,T(S.value,l=>(f(),u("option",{key:l.id,value:l.id},W(l.label),9,_e))),128))],8,ge),[[se,a.linked_plan_id]])])):(f(),u("div",ke)),a.allowLink?(f(),u("div",ye,[e("div",he,[c(e("input",{type:"checkbox",id:`status_${a.key}`,"onUpdate:modelValue":l=>a.enabled=l,onChange:l=>q(a)},null,40,we),[[ae,a.enabled]])])])):(f(),u("div",xe))]))),128))]),e("div",Ce,[e("div",Pe,[t[17]||(t[17]=e("label",{class:"bulk-label"},"نوع تغییر",-1)),e("div",Ve,[e("label",Ne,[c(e("input",{type:"radio",value:"increase","onUpdate:modelValue":t[1]||(t[1]=a=>n.tariffs.bulk.direction=a)},null,512),[[R,n.tariffs.bulk.direction]]),t[13]||(t[13]=e("span",null,"افزایش قیمت",-1))]),e("label",Se,[c(e("input",{type:"radio",value:"decrease","onUpdate:modelValue":t[2]||(t[2]=a=>n.tariffs.bulk.direction=a)},null,512),[[R,n.tariffs.bulk.direction]]),t[14]||(t[14]=e("span",null,"کاهش قیمت",-1))])]),e("div",Ue,[t[16]||(t[16]=e("label",{class:"bulk-label small"},"درصد",-1)),e("div",$e,[c(e("input",{class:"form-input",type:"number",min:"0",step:"0.1","onUpdate:modelValue":t[3]||(t[3]=a=>n.tariffs.bulk.percent=a)},null,512),[[_,n.tariffs.bulk.percent,void 0,{number:!0}]]),t[15]||(t[15]=e("span",{class:"suffix"},"%",-1))])])]),t[18]||(t[18]=e("p",{class:"bulk-hint warning"},[e("i",{class:"fas fa-exclamation-triangle",style:{color:"#fcff41ff","line-height":"1.7","margin-left":"6px","font-size":"8px"}}),te(" با افزایش یا کاهش قیمت، کلیه قیمت تعرفه‌های پنل (پیش‌فرض و شخصی سازی) تحت تأثیر قرار خواهند گرفت. ")],-1))])],512),[[g,i.tariffs]])],2),e("section",{class:m(["settings-card",{open:i.card}])},[e("header",{class:"settings-card__header",onClick:t[4]||(t[4]=a=>b("card"))},[t[19]||(t[19]=e("div",{class:"h-left"},[e("i",{class:"fas fa-credit-card"}),e("span",null,"تنظیمات کارت"),e("small",null,"نمایش برای واریزهای کارت‌ به‌ کارت")],-1)),e("button",{type:"button",class:"chev-btn","aria-expanded":i.card},[e("i",{class:m(["fas",i.card?"fa-chevron-up":"fa-chevron-down"])},null,2)],8,Le)]),c(e("div",De,[e("div",Ie,[e("div",Be,[t[20]||(t[20]=e("div",{class:"td td-label"},"نام صاحب کارت",-1)),e("div",Ee,[c(e("input",{class:"form-input","onUpdate:modelValue":t[5]||(t[5]=a=>n.card.holder=a),placeholder:"نام و نام خانوادگی"},null,512),[[_,n.card.holder]])])]),e("div",He,[t[21]||(t[21]=e("div",{class:"td td-label"},"شماره کارت",-1)),e("div",Me,[e("input",{class:"form-input",type:"text",inputmode:"numeric",autocomplete:"off",placeholder:"0000-0000-0000-0000",value:D(n.card.card_number),onInput:J},null,40,Te)])])])],512),[[g,i.card]])],2),e("section",{class:m(["settings-card",{open:i.commission}])},[e("header",{class:"settings-card__header",onClick:t[6]||(t[6]=a=>b("commission"))},[t[22]||(t[22]=e("div",{class:"h-left"},[e("i",{class:"fas fa-handshake"}),e("span",null,"تنظیمات کمیسیون معرف")],-1)),e("button",{type:"button",class:"chev-btn","aria-expanded":i.commission},[e("i",{class:m(["fas",i.commission?"fa-chevron-up":"fa-chevron-down"])},null,2)],8,Re)]),c(e("div",We,[e("div",je,[e("div",ze,[t[23]||(t[23]=e("div",{class:"td td-label"},"درصد پیش‌ فرض",-1)),e("div",Fe,[c(e("input",{class:"form-input","onUpdate:modelValue":t[7]||(t[7]=a=>n.commission.default_percent=a),type:"number",min:"0",max:"100",step:"0.1",placeholder:"0-100"},null,512),[[_,n.commission.default_percent,void 0,{number:!0}]])])])])],512),[[g,i.commission]])],2),e("section",{class:m(["settings-card",{open:i.telegramPartners}])},[e("header",{class:"settings-card__header",onClick:t[8]||(t[8]=a=>b("telegramPartners"))},[t[24]||(t[24]=e("div",{class:"h-left"},[e("i",{class:"fab fa-telegram"}),e("span",null,"ربات تلگرام (همکاران)"),e("small",null,"مخصوص همکاران/نمایندگان")],-1)),e("button",{type:"button",class:"chev-btn","aria-expanded":i.telegramPartners},[e("i",{class:m(["fas",i.telegramPartners?"fa-chevron-up":"fa-chevron-down"])},null,2)],8,Oe)]),c(e("div",Ae,[e("div",Ke,[e("div",qe,[t[25]||(t[25]=e("div",{class:"td td-label"},"توکن",-1)),e("div",Ge,[c(e("input",{class:"form-input","onUpdate:modelValue":t[9]||(t[9]=a=>n.telegramPartners.token=a),placeholder:"توکنی که از ربات Botfather دریافت شده است",autocomplete:"off"},null,512),[[_,n.telegramPartners.token]])])])]),e("div",Je,[e("button",{class:"btn-create-user1 btn-alt btn-alt--danger",onClick:A,disabled:r.value},t[26]||(t[26]=[e("span",null,"Remove Webhook",-1)]),8,Qe),e("button",{class:"btn-create-user1 btn-alt",onClick:O,disabled:r.value,style:{"margin-inline-start":"8px"}},t[27]||(t[27]=[e("span",null,"Set Webhook",-1)]),8,Xe)])],512),[[g,i.telegramPartners]])],2),e("section",{class:m(["settings-card",{open:i.telegramNotify}])},[e("header",{class:"settings-card__header",onClick:t[10]||(t[10]=a=>b("telegramNotify"))},[t[28]||(t[28]=e("div",{class:"h-left"},[e("i",{class:"fab fa-telegram"}),e("span",null,"ربات تلگرام (کاربران)"),e("small",null,"مخصوص کاربران ساخته شده با پنل ادمین")],-1)),e("button",{type:"button",class:"chev-btn","aria-expanded":i.telegramNotify},[e("i",{class:m(["fas",i.telegramNotify?"fa-chevron-up":"fa-chevron-down"])},null,2)],8,Ye)]),c(e("div",Ze," به زودی اضافه خواهد شد ",512),[[g,i.telegramNotify]])],2)]),r.value?(f(),u("div",et,t[29]||(t[29]=[e("div",{class:"creating-box"},[e("span",null,"... در حال ذخیره"),e("i",{class:"fas fa-spinner fa-spin"})],-1)]))):Z("",!0),e("div",tt,[e("button",{class:"btn-create-user1",onClick:z,disabled:r.value},t[30]||(t[30]=[e("span",null,"ذخیره",-1)]),8,st)])])]))}},it=X(at,[["__scopeId","data-v-9d61cf88"]]);export{it as default};
